import{u as b}from"./useStories.BHihIbIz.js";import{r as I,j as K,m as h}from"./runtime-core.esm-bundler.Yc9PgZSd.js";const r=[{level:1,titleKey:"gamification.level.apprentice",minXP:0,maxXP:1e3,color:"blue",tier:"apprentice"},{level:2,titleKey:"gamification.level.apprentice",minXP:1e3,maxXP:2e3,color:"blue",tier:"apprentice"},{level:3,titleKey:"gamification.level.apprentice",minXP:2e3,maxXP:3e3,color:"blue",tier:"apprentice"},{level:4,titleKey:"gamification.level.adventurer",minXP:3e3,maxXP:4500,color:"green",tier:"adventurer"},{level:5,titleKey:"gamification.level.adventurer",minXP:4500,maxXP:6e3,color:"green",tier:"adventurer"},{level:6,titleKey:"gamification.level.adventurer",minXP:6e3,maxXP:7500,color:"green",tier:"adventurer"},{level:7,titleKey:"gamification.level.explorer",minXP:7500,maxXP:9500,color:"purple",tier:"explorer"},{level:8,titleKey:"gamification.level.explorer",minXP:9500,maxXP:11500,color:"purple",tier:"explorer"},{level:9,titleKey:"gamification.level.explorer",minXP:11500,maxXP:13500,color:"purple",tier:"explorer"},{level:10,titleKey:"gamification.level.guardian",minXP:13500,maxXP:15500,color:"gold",tier:"guardian"},{level:11,titleKey:"gamification.level.guardian",minXP:15500,maxXP:17500,color:"gold",tier:"guardian"},{level:12,titleKey:"gamification.level.guardian",minXP:17500,maxXP:19500,color:"gold",tier:"guardian"},{level:13,titleKey:"gamification.level.guardian",minXP:19500,maxXP:21500,color:"gold",tier:"guardian"},{level:14,titleKey:"gamification.level.guardian",minXP:21500,maxXP:23500,color:"gold",tier:"guardian"},{level:15,titleKey:"gamification.level.guardian",minXP:23500,maxXP:25500,color:"gold",tier:"guardian"},{level:16,titleKey:"gamification.level.master",minXP:25500,maxXP:27500,color:"silver",tier:"master"},{level:17,titleKey:"gamification.level.master",minXP:27500,maxXP:29500,color:"silver",tier:"master"},{level:18,titleKey:"gamification.level.master",minXP:29500,maxXP:31500,color:"silver",tier:"master"},{level:19,titleKey:"gamification.level.master",minXP:31500,maxXP:33500,color:"silver",tier:"master"},{level:20,titleKey:"gamification.level.master",minXP:33500,maxXP:4e4,color:"silver",tier:"master"}],p={completeStory:c=>100+Math.floor(c/10),favorite:10,halfProgressReward:50,songCompletion:75};function z(){const{getCompleteStories:c,getFavoriteStories:x,getAllStories:D}=b(),l=I({level:1,totalXP:0,currentLevelXP:0,nextLevelXP:1e3,title:"Aprendiz de Historias",titleKey:"gamification.level.apprentice",avatar:1,color:"blue"});function f(){if(typeof localStorage>"u"){m();return}const t=localStorage.getItem("playerProfile");if(t)try{const e=JSON.parse(t);if(e.totalXP!==void 0&&!e.level){const a=d(e.totalXP);l.value={level:a.level,totalXP:e.totalXP,currentLevelXP:e.totalXP-(a.minXP||0),nextLevelXP:a.maxXP-(a.minXP||0),title:u(a.level),titleKey:a.titleKey,avatar:a.level,color:a.color}}else l.value=e}catch(e){console.warn("Failed to load player profile",e),m()}else m()}function s(){typeof localStorage>"u"||localStorage.setItem("playerProfile",JSON.stringify({totalXP:l.value.totalXP}))}function m(){l.value={level:1,totalXP:0,currentLevelXP:0,nextLevelXP:1e3,title:"Aprendiz de Historias",titleKey:"gamification.level.apprentice",avatar:1,color:"blue"},s()}function g(t){const a=D().find(v=>v.key===t);if(!a)return{baseXP:0,bonusXP:0,totalXP:0};const o=Math.ceil(parseInt(a.time)/60),i=p.completeStory(o);let P=[];typeof localStorage<"u"&&(P=JSON.parse(localStorage.getItem("storiesData")||"[]"));const n=P.find(v=>v.key===t);let X=0;return n&&n.spentTime&&n.totalTime&&n.spentTime/n.totalTime*100>=50&&(X=p.halfProgressReward),x().some(v=>v.key===t)&&(X+=p.favorite),{baseXP:i,bonusXP:X,totalXP:i+X}}function y(t){const e=l.value.level;l.value.totalXP+=t,l.value.currentLevelXP+=t;let a=!1,o=e;for(;l.value.level<20;){r[l.value.level-1];const i=r[l.value.level];if(l.value.totalXP>=i.minXP)l.value.level=i.level,l.value.currentLevelXP=l.value.totalXP-i.minXP,l.value.nextLevelXP=i.maxXP-i.minXP,l.value.title=u(i.level),l.value.titleKey=i.titleKey,l.value.avatar=i.level,l.value.color=i.color,o=i.level,a=!0;else break}if(l.value.level>20){l.value.level=20;const i=r[19];l.value.nextLevelXP=i.maxXP-i.minXP}return s(),{leveledUp:a,newLevel:o}}function u(t){const e=r[t-1];return e&&{"gamification.level.apprentice":"Aprendiz de Historias","gamification.level.adventurer":"Lector Aventurero","gamification.level.explorer":"Explorador de Mundos","gamification.level.guardian":"GuardiÃ¡n de Sagas","gamification.level.master":"Maestro de Cuentos"}[e.titleKey]||"Aprendiz de Historias"}function L(){const t=c();let e=0;return t.forEach(a=>{const o=g(a.key);e+=o.totalXP,o.totalXP===0&&console.warn(`âš ï¸ No XP calculated for story: ${a.key}`)}),t.length>0&&console.log(`ðŸ“Š Retroactive XP: ${e} XP from ${t.length} stories`),e}function S(){f();const t=L();if(t!==l.value.totalXP){console.log(`ðŸ”„ Updating XP from ${l.value.totalXP} to ${t}`),l.value.totalXP=t;const e=d(t);l.value.level=e.level,l.value.currentLevelXP=e.minXP?t-e.minXP:0,l.value.nextLevelXP=e.maxXP-(e.minXP||0),l.value.title=u(e.level),l.value.avatar=e.level,l.value.color=e.color,s()}}function T(t){const e=g(t),{leveledUp:a,newLevel:o}=y(e.totalXP);return{xpGained:e.totalXP,leveledUp:a,newLevel:o}}const M=K(()=>{if(l.value.level>=20)return{level:20,xpNeeded:0,xpProgress:100,isMaxLevel:!0};const e=l.value.level+1,a=r[e-1];return{level:e,xpNeeded:a.minXP-l.value.totalXP,xpProgress:l.value.currentLevelXP/l.value.nextLevelXP*100,isMaxLevel:!1}});function d(t){for(let e=r.length-1;e>=0;e--)if(t>=r[e].minXP)return r[e];return r[0]}const R=K(()=>{let t=[];typeof localStorage<"u"&&(t=JSON.parse(localStorage.getItem("storiesData")||"[]"));const e=c(),a=x();let o=0;t.forEach(n=>{n.spentTime&&(o+=n.spentTime)});const i=Math.floor(o/60),P=Math.floor(i/60);return{totalStoriesRead:e.length,totalFavorites:a.length,totalReadingTime:`${P}h ${i%60}m`,averagePerStory:e.length>0?Math.round(o/e.length):0}});return f(),typeof localStorage<"u"&&S(),{playerProfile:l,nextLevelInfo:h(M),readingStats:h(R),loadPlayerProfile:f,savePlayerProfile:s,initializePlayerProfile:m,calculateStoryXP:g,addXP:y,getTitleForLevel:u,calculateRetroactiveXP:L,initializeWithRetroactiveXP:S,onStoryCompleted:T,getLevelFromXP:d}}export{z as u};
