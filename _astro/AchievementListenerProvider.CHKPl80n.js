import{w as ge,T as ce}from"./runtime-dom.esm-bundler.BU_tAFEj.js";import{o as _e,a as pe,c as F}from"./achievementEvents.DHKWVqNG.js";import{r as N,m as $,c as ke,o as m,a as M,w as re,g as v,b as y,e as c,t as f,n as G,F as z,h as Q,i as le,ae as ye,j as w,d as L,l as be,f as ee,af as te}from"./runtime-core.esm-bundler.Yc9PgZSd.js";import{f as ne}from"./index.brZL-3I0.js";import{t as K}from"./index.sXTMffxN.js";import{_ as X}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{u as ae,A as _,c as oe,s as q,i as b,a as g}from"./useAchievements.DAZ-nXoM.js";import{b as Ae,c as Ce}from"./index.DURh_9Xy.js";import"./useStories.B96ulDsN.js";import"./useStory.CxzHw2-Z.js";const k=N(null),I=N([]);let O=!1,P=null,U=null;function R(){function r(){n(),P=_e(o=>{o.isNew&&i({id:o.achievement.id,nameKey:o.achievement.nameKey,descriptionKey:o.achievement.descriptionKey,iconId:o.achievement.iconId,metadata:o.achievement.metadata,type:"unlock"})}),U=pe(o=>{[25,50,75,100].includes(o.progress)&&o.isNew&&i({id:o.achievementId,nameKey:"achievement.progress",descriptionKey:"achievement.progress.description",iconId:"progress-indicator",type:"progress",progress:o.progress,current:o.current,target:o.target})})}function n(){P&&(P(),P=null),U&&(U(),U=null)}function i(o){const d={id:`${o.id}-${Date.now()}`,data:o,timestamp:Date.now()};I.value.push(d),e()}function e(){if(O||I.value.length===0)return;O=!0;const o=I.value.shift();if(o){o.displayedAt=Date.now(),k.value=o;const d=o.data.type==="unlock"?4e3:2e3;setTimeout(()=>{t()},d)}}function t(){k.value=null,O=!1,I.value.length>0&&setTimeout(()=>{e()},300)}function s(){t()}function a(){k.value=null,I.value=[],O=!1}function l(){return k.value?{...k.value.data,displayDuration:k.value.displayedAt?Date.now()-k.value.displayedAt:0}:null}return{currentNotification:$(k),pendingNotifications:$(I),showNotification:i,closeNotification:t,dismiss:s,clearAll:a,getCurrentNotification:l,setupEventListeners:r,teardownEventListeners:n}}let j=null;function se(){return j||(j=R(),j.setupEventListeners()),j}const we={__name:"AchievementUnlock",setup(r,{expose:n}){n();const{currentNotification:i,dismiss:e}=R(),t=w(()=>i.value?.data||null),s=w(()=>t.value?K(t.value.nameKey):""),a=w(()=>t.value?K(t.value.descriptionKey):""),l=w(()=>({"achievement-unlock-v2__container--progress":t.value?.type==="progress","achievement-unlock-v2__container--unlock":t.value?.type==="unlock"})),o=w(()=>ne());function d(u,h){return u?`/assets/achievements/${h?.folder||"read"}/${u}.png`:"/assets/account/get-achievement.webp"}function E(u){console.warn("Failed to load achievement icon:",u.target.src),u.target.style.display="none"}function V(u){const p=Array.from({length:12},(fe,J)=>J*360/12)[u-1],C=u*.05%.6;return{"--angle":p,"--delay":`${C}s`,animationDelay:`${C}s`}}function W(u){const p=Array.from({length:6},(fe,J)=>J*360/6)[u-1],C=u*.1%.5;return{"--angle":p,"--delay":`${C}s`,animationDelay:`${C}s`}}const D={currentNotification:i,dismiss:e,notification:t,notificationName:s,notificationDescription:a,containerClasses:l,achievementsLink:o,getIconPath:d,handleImageError:E,getConfettiStyle:V,getSparkStyle:W,handleClose:()=>{e()},computed:w,get useAchievementNotification(){return R},get toAccountAchievements(){return ne},get t(){return K}};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}},Se={class:"achievement-unlock-v2__image-wrapper"},Ne={key:0,class:"achievement-unlock-v2__icon-frame"},Te=["src","alt"],Ee={key:0,class:"achievement-unlock-v2__shine"},Ie={key:1,src:"/assets/account/get-achievement.webp",alt:"Achievement Unlocked",class:"achievement-unlock-v2__fallback-image"},De={class:"achievement-unlock-v2__content"},Ke={class:"achievement-unlock-v2__label"},Le={class:"achievement-unlock-v2__title"},Oe={class:"achievement-unlock-v2__description"},Pe={key:0,class:"achievement-unlock-v2__progress"},Ue={class:"achievement-unlock-v2__progress-bar"},je={class:"achievement-unlock-v2__progress-text"},Fe=["href"];function qe(r,n,i,e,t,s){return m(),ke(ye,{to:"body"},[M(ce,{name:"achievement-unlock-v2"},{default:re(()=>[e.currentNotification?(m(),v("div",{key:0,class:"achievement-unlock-v2",onClick:ge(e.handleClose,["self"])},[c("div",{class:le(["achievement-unlock-v2__container",e.containerClasses])},[n[0]||(n[0]=c("div",{class:"achievement-unlock-v2__bg-glow"},null,-1)),c("div",Se,[e.notification?(m(),v("div",Ne,[c("img",{src:e.getIconPath(e.notification.iconId,e.notification.metadata),alt:e.notification.nameEs,class:"achievement-unlock-v2__icon",onError:e.handleImageError},null,40,Te),e.notification.type==="unlock"?(m(),v("div",Ee)):y("",!0)])):y("",!0),!e.notification||!e.notification.iconId?(m(),v("img",Ie)):y("",!0)]),c("div",De,[c("p",Ke,f(e.notification?.type==="unlock"?e.t("achievement.unlocked"):e.t("achievement.progress")||"Progreso"),1),c("h2",Le,f(e.notificationName),1),c("p",Oe,f(e.notificationDescription),1),e.notification?.type==="progress"?(m(),v("div",Pe,[c("div",Ue,[c("div",{class:"achievement-unlock-v2__progress-fill",style:G({width:`${e.notification.progress}%`})},null,4)]),c("p",je,f(e.notification.current)+"/"+f(e.notification.target),1)])):y("",!0)]),e.notification?.type==="unlock"?(m(),v("a",{key:0,href:e.achievementsLink,class:"achievement-unlock-v2__button",onClick:e.handleClose},f(e.t("achievement.view")),9,Fe)):y("",!0),(m(),v(z,null,Q(12,a=>c("div",{key:a,class:"achievement-unlock-v2__confetti",style:G(e.getConfettiStyle(a))},null,4)),64)),(m(),v(z,null,Q(6,a=>c("div",{key:`spark-${a}`,class:"achievement-unlock-v2__spark",style:G(e.getSparkStyle(a))},null,4)),64))],2)])):y("",!0)]),_:1})])}const xe=X(we,[["render",qe],["__scopeId","data-v-67a17f41"]]),Me={__name:"AchievementDebug",setup(r,{expose:n}){n();const i=!1,e=N(!1),{allAchievements:t,unlockedAchievements:s,lockedAchievements:a,stats:l,recalculateAll:o}=ae();function d(u){return K(u.nameKey)}function E(u){const h=_.find(C=>C.id===u);if(!h)return;const p=new Date;q(u,p),F({achievement:{id:h.id,type:h.type,nameKey:h.nameKey,descriptionKey:h.descriptionKey,iconId:h.iconId,unlocked:!0,unlockedAt:p,threshold:h.threshold,metadata:h.metadata},unlockedAt:p,isNew:!0}),o()}function V(){confirm("¿Estás seguro de que quieres limpiar todos los logros?")&&(oe(),o())}function W(){confirm("¿Estás seguro de que quieres desbloquear todos los logros?")&&(_.forEach(u=>{const h=new Date;q(u.id,h),F({achievement:{id:u.id,type:u.type,nameKey:u.nameKey,descriptionKey:u.descriptionKey,iconId:u.iconId,unlocked:!0,unlockedAt:h,threshold:u.threshold,metadata:u.metadata},unlockedAt:h,isNew:!0})}),o())}function Z(){console.log({total:t.value.length,unlocked:s.value.length,locked:a.value.length,progress:l.value.progressPercentage+"%",achievements:t.value})}const D={isDev:i,isOpen:e,allAchievements:t,unlockedAchievements:s,lockedAchievements:a,stats:l,recalculateAll:o,getAchievementName:d,simulateAchievementUnlock:E,clearAllAchievements:V,unlockAllAchievements:W,showAchievementsInfo:Z,ref:N,computed:w,get useAchievements(){return ae},get saveAchievementUnlock(){return q},get clearAchievements(){return oe},get emitAchievementUnlock(){return F},get ALL_ACHIEVEMENT_DEFINITIONS(){return _},get t(){return K}};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}},ze={key:0,class:"achievement-debug"},Be={key:0,class:"achievement-debug__panel"},Ve={class:"achievement-debug__header"},We={class:"achievement-debug__section"},Je={class:"achievement-debug__list"},Ge=["onClick"],He={class:"achievement-debug__achievement-name"},Qe={key:0,class:"achievement-debug__badge"},Re={key:1,class:"achievement-debug__badge achievement-debug__badge--locked"},Xe={class:"achievement-debug__section"},Ye={class:"achievement-debug__info"};function Ze(r,n,i,e,t,s){return e.isDev?(m(),v("div",ze,[c("button",{class:"achievement-debug__toggle",onClick:n[0]||(n[0]=a=>e.isOpen=!e.isOpen)}," 🐛 "),M(ce,{name:"debug-slide"},{default:re(()=>[e.isOpen?(m(),v("div",Be,[c("div",Ve,[n[2]||(n[2]=c("h3",null,"Sistema de Logros - Debug",-1)),c("button",{class:"achievement-debug__close",onClick:n[1]||(n[1]=a=>e.isOpen=!1)},"✕")]),c("div",We,[n[3]||(n[3]=c("h4",null,"Logros Disponibles",-1)),c("div",Je,[(m(!0),v(z,null,Q(e.allAchievements,a=>(m(),v("button",{key:a.id,class:le(["achievement-debug__achievement-btn",{"achievement-debug__achievement-btn--unlocked":a.unlocked}]),onClick:l=>e.simulateAchievementUnlock(a.id)},[c("span",He,f(e.getAchievementName(a)),1),a.unlocked?(m(),v("span",Qe,"✓ Desbloqueado")):(m(),v("span",Re,"🔒 Bloqueado"))],10,Ge))),128))])]),c("div",{class:"achievement-debug__section"},[n[4]||(n[4]=c("h4",null,"Utilidades",-1)),c("div",{class:"achievement-debug__utilities"},[c("button",{class:"achievement-debug__btn achievement-debug__btn--info",onClick:e.showAchievementsInfo}," 📊 Ver Info "),c("button",{class:"achievement-debug__btn achievement-debug__btn--warning",onClick:e.clearAllAchievements}," 🗑️ Limpiar Todo "),c("button",{class:"achievement-debug__btn achievement-debug__btn--success",onClick:e.unlockAllAchievements}," 🎯 Desbloquear Todo ")])]),c("div",Xe,[n[9]||(n[9]=c("h4",null,"Estado Actual",-1)),c("div",Ye,[c("p",null,[n[5]||(n[5]=c("strong",null,"Total:",-1)),L(" "+f(e.allAchievements.length),1)]),c("p",null,[n[6]||(n[6]=c("strong",null,"Desbloqueados:",-1)),L(" "+f(e.unlockedAchievements.length),1)]),c("p",null,[n[7]||(n[7]=c("strong",null,"Bloqueados:",-1)),L(" "+f(e.lockedAchievements.length),1)]),c("p",null,[n[8]||(n[8]=c("strong",null,"Progreso:",-1)),L(" "+f(Math.round(e.stats.progressPercentage))+"%",1)])])])])):y("",!0)]),_:1})])):y("",!0)}const $e=X(Me,[["render",Ze],["__scopeId","data-v-b915d4c7"]]),S=N([]),x=N([]);function Y(){try{S.value=Ae(),x.value=Ce()}catch{}}const B=N([]);let H=!1;function T(){if(typeof window>"u")return[];try{const r=localStorage.getItem("storiesData");return r?JSON.parse(r):[]}catch{return[]}}function et(){const r=T(),n=B.value;let i=!1,e=!1;r.forEach(t=>{if(!t||!t.key||typeof t.spentTime!="number"||typeof t.totalTime>"u")return;const s=n.find(E=>E?.key===t.key),a=t.spentTime>=parseFloat(String(t.totalTime)),l=s&&s.spentTime>=parseFloat(String(s.totalTime));a&&!l&&(i=!0);const o=t.like===!0,d=s&&s.like===!0;o!==d&&(e=!0)}),i&&ue(),e&&de(),(i||e)&&(he(),me(),ve()),B.value=JSON.parse(JSON.stringify(r))}function ue(){const n=T().filter(e=>e&&typeof e.spentTime=="number"&&typeof e.totalTime<"u"&&e.spentTime>=parseFloat(String(e.totalTime))).length;_.filter(e=>e.type==="read").forEach(e=>{const t=e.threshold||1;n>=t&&!b(e.id)&&A(e.id),g(e.id,n,t)})}function de(){const n=T().filter(e=>e&&e.like===!0).length;_.filter(e=>e.type==="favorite").forEach(e=>{const t=e.threshold||1;n>=t&&!b(e.id)&&A(e.id),g(e.id,n,t)})}function he(){try{S.value.length===0&&Y();const r=T().filter(t=>t&&typeof t.spentTime=="number"&&typeof t.totalTime<"u"&&t.spentTime>=parseFloat(String(t.totalTime))),n={};r.forEach(t=>{const s=S.value.find(a=>a.key===t.key);s?.saga&&s.saga.trim()!==""&&(n[s.saga]=(n[s.saga]||0)+1)});const i={};S.value.forEach(t=>{t.saga&&t.saga.trim()!==""&&(i[t.saga]=(i[t.saga]||0)+1)}),_.filter(t=>t.type==="saga").forEach(t=>{const s=t.threshold||1;if(t.id.startsWith("saga-")&&t.id!=="saga-all"){const a=Object.keys(n).length;a>=s&&!b(t.id)&&A(t.id),g(t.id,Math.min(a,s),s)}else if(t.id==="saga-all"){let a=!1,l=0;Object.entries(i).forEach(([o,d])=>{(n[o]||0)===d&&l++}),a=l===Object.keys(i).length&&Object.keys(i).length>0,a&&!b("saga-all")&&A("saga-all"),g("saga-all",a?1:0,1)}})}catch{}}function me(){try{(x.value.length===0||S.value.length===0)&&Y();const r=T().filter(t=>t&&typeof t.spentTime=="number"&&typeof t.totalTime<"u"&&t.spentTime>=parseFloat(String(t.totalTime))),n={};r.forEach(t=>{if(!t||!t.key)return;const s=S.value.find(a=>a.key===t.key);s?.saga&&s.saga.trim()!==""&&x.value.filter(l=>l.saga===s.saga).forEach(l=>{n[l.key]||(n[l.key]=new Set),n[l.key].add(t.key)})});const i={};S.value.forEach(t=>{t.saga&&t.saga.trim()!==""&&x.value.filter(a=>a.saga===t.saga).forEach(a=>{i[a.key]||(i[a.key]=new Set),i[a.key].add(t.key)})}),_.filter(t=>t.type==="character").forEach(t=>{const s=t.threshold||1;if(t.id==="char-5"){Object.entries(n).some(([o,d])=>d.size>=5)&&!b("char-5")&&A("char-5");const l=Math.max(...Object.values(n).map(o=>o.size),0);g("char-5",Math.min(l,s),s)}else if(t.id==="char-10"){Object.entries(n).some(([o,d])=>d.size>=10)&&!b("char-10")&&A("char-10");const l=Math.max(...Object.values(n).map(o=>o.size),0);g("char-10",Math.min(l,s),s)}else if(t.id==="char-all"){const a=Object.entries(i).some(([l,o])=>(n[l]?.size||0)===o.size&&o.size>0);a&&!b("char-all")&&A("char-all"),g("char-all",a?1:0,1)}else if(t.id==="char-profiles"){const a=Object.entries(n).filter(([l,o])=>o.size>0).length;a>=s&&!b("char-profiles")&&A("char-profiles"),g("char-profiles",Math.min(a,s),s)}})}catch{}}function ve(){try{const n=T().filter(e=>e&&typeof e.spentTime=="number"&&typeof e.totalTime<"u"&&e.spentTime>=parseFloat(String(e.totalTime))).length;_.filter(e=>e.type==="special").forEach(e=>{g(e.id,0,1)})}catch{}}function A(r){const n=_.find(e=>e.id===r);if(!n)return;const i=new Date;q(r,i),F({achievement:{id:n.id,type:n.type,nameKey:n.nameKey,descriptionKey:n.descriptionKey,iconId:n.iconId,unlocked:!0,unlockedAt:i,threshold:n.threshold,metadata:n.metadata},unlockedAt:i,isNew:!0})}function ie(){function r(){if(H)return()=>{};H=!0,B.value=T(),Y();const e=setInterval(()=>{et()},2e3);return()=>{clearInterval(e),H=!1}}function n(){ue(),de(),he(),me(),ve()}function i(){B.value=[]}return{startListening:r,forceCheck:n,resetCache:i}}const tt={__name:"AchievementListenerProvider",setup(r,{expose:n}){n();const{startListening:i,forceCheck:e}=ie(),{setupEventListeners:t}=se();ee(()=>{const a=i();t(),e(),window.__achievementCleanup=()=>{a()}}),te(()=>{window.__achievementCleanup&&window.__achievementCleanup()});const s={startListening:i,forceCheck:e,setupEventListeners:t,onMounted:ee,onBeforeUnmount:te,AchievementUnlock:xe,AchievementDebug:$e,get useAchievementListener(){return ie},get getGlobalAchievementNotification(){return se}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}};function nt(r,n,i,e,t,s){return m(),v(z,null,[be(r.$slots,"default"),M(e.AchievementUnlock),M(e.AchievementDebug)],64)}const mt=X(tt,[["render",nt]]);export{mt as default};
