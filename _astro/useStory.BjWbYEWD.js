import{a as v}from"./index.CLpcdzyz.js";import{r as u,p as s}from"./runtime-core.esm-bundler.BLIdz6c-.js";const y=v();function I(a){const o=u([]),t=u({}),p=()=>a.story.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).filter(e=>e.trim()!=="")[0],m=()=>a.story.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).filter(e=>e.trim()!=="").map((e,n)=>`<p key=${n}>${e}</p>`).join(""),f=()=>`${Math.ceil(parseInt(a.time)/60)} min`,d=()=>{if(a.saga)return y.find(e=>e.key===a.saga)?.name},l=()=>{if(!a||!a.key){console.warn("useStory: story or story.key is null/undefined");return}o.value=JSON.parse(localStorage.getItem("storiesData"))||[];const e=s(o)||[];t.value=e.find(n=>n&&n.key===a.key)},c=()=>{try{l();const e=s(t),n=Math.ceil(e.spentTime/parseInt(e.totalTime)*100),r=n>100?100:n;return{...e,current:r}}catch{return{}}},g=()=>c().current>=100,S=e=>{const n=t.value;n.like=e,t.value=n,i()},i=()=>{if(!a||!a.key){console.warn("useStory: cannot save - story or story.key is null/undefined");return}const e=JSON.parse(localStorage.getItem("storiesData"))||[],n=e.findIndex(r=>r&&r.key===a.key);n===-1?e.push(s(t)):e[n]=s(t),localStorage.setItem("storiesData",JSON.stringify(e))},k=()=>{if(!t.value||t.value.spentTime===void 0){console.warn("useStory: cannot update time - story data not initialized");return}let e=t.value;e.spentTime+=10,e.spentTime>=parseInt(e.totalTime)&&(e.finished=!0,e.completedAt||(e.completedAt=Date.now())),t.value=e,i()};return{firstParagraph:p,getTime:f,html:m,getSaga:d,getCurrentStatus:c,setLikeStatus:S,isComplete:g,reading:()=>{l(),!t.value||Object.keys(t.value).length===0?t.value={key:a.key,spentTime:0,totalTime:parseInt(a.time),finished:!1,like:!1,startedAt:Date.now()}:t.value.startedAt||(t.value.startedAt=Date.now()),i(),setInterval(k,1e4)}}}export{I as u};
