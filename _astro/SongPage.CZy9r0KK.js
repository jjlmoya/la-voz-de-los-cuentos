import{_ as W,g as X,w as Z,I as $}from"./_plugin-vue_export-helper.BpNMFbcL.js";import{B as ee}from"./Breadcrumbs.DZgO5L_m.js";import{L as te}from"./LanguageSwitcher.zVR9bQVe.js";import{t as ae}from"./index.D3Lt6ofz.js";import{a as ne,b as E}from"./index.BMPHkLeA.js";/* empty css                      */import{a as oe,w as x,g as v,j as z,k as I,h as j,l as U,o as u,b as k,e,t as c,c as y,d as L,F as D,r as O,m as p,f as q}from"./runtime-dom.esm-bundler.n5zixiYy.js";/* empty css                      */import"./index.C8oHcxzd.js";import"./landings.Fs2A2SQT.js";/* empty css                      */const se={__name:"SongPage",props:{song:{type:Object,required:!0},allSongs:{type:Array,default:()=>[]},currentSaga:{type:Object,default:null},relatedStory:{type:Object,default:null}},setup(C,{expose:i}){i();const o="es",a=n=>{if(!n)return"";const t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,g=n.match(t);return g&&g[2].length===11?g[2]:n},l=C,d=v(!1),s=v(!0),r=v(!1),m=v(!1),h=v(0);let f=null,_=null;const F=z(()=>l.song.lyrics?l.song.lyrics.replace(/<br\s*\/?>/gi,`
`).replace(/\n{3,}/g,`

`).replace(/\n/g,"<br>"):""),P=n=>h.value>=n.start&&h.value<n.end;I(h,()=>{if(!l.song.syncedLyrics||l.song.syncedLyrics.length===0)return;const n=l.song.syncedLyrics.findIndex(t=>P(t));if(n!==-1){const t=document.querySelector(".song-page__karaoke-content"),g=document.querySelectorAll(".song-page__karaoke-line")[n];if(t&&g){const H=t.scrollTop,R=t.clientHeight,T=g.offsetTop-t.offsetTop,Y=g.clientHeight,Q=T-R/2+Y/2;(T<H||T+Y>H+R)&&t.scrollTo({top:Q,behavior:"smooth"})}}});const w=()=>{_&&clearInterval(_),_=setInterval(()=>{f&&typeof f.getCurrentTime=="function"&&(h.value=f.getCurrentTime())},100)},G=()=>{d.value=!d.value,d.value&&(s.value=!1,r.value=!1)},J=()=>{s.value=!s.value,s.value&&(d.value=!1)},K=()=>{r.value=!r.value,r.value&&(d.value=!1)},M=()=>{d.value?f?.playVideo():s.value&&B()},B=()=>{const n=l.allSongs.findIndex(t=>t.key===l.song.key);if(r.value){let t;do t=Math.floor(Math.random()*l.allSongs.length);while(t===n&&l.allSongs.length>1);const g=l.allSongs[t];S(g.key)}else if(n!==-1)if(n<l.allSongs.length-1){const t=l.allSongs[n+1];S(t.key)}else{const t=l.allSongs[0];S(t.key)}},S=n=>{window.location.href=E(n)},V=()=>{if(window.YT)b();else{const n=document.createElement("script");n.src="https://www.youtube.com/iframe_api";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t),window.onYouTubeIframeAPIReady=b}},b=()=>{const n=a(l.song.song);f=new window.YT.Player(`youtube-player-${l.song.key}`,{videoId:n,width:"100%",height:"100%",playerVars:{autoplay:1,rel:0,modestbranding:1,cc_load_policy:1},events:{onReady:t=>{window.__ytPlayer=t.target,w()},onStateChange:t=>{t.data===window.YT.PlayerState.ENDED&&M(),t.data===window.YT.PlayerState.PLAYING&&(m.value=!0,w()),t.data===window.YT.PlayerState.PAUSED&&_&&clearInterval(_)}}})};j(()=>{m.value=!0;const n=localStorage.getItem("songRepeat"),t=localStorage.getItem("songAutoplay"),g=localStorage.getItem("songShuffle");n!==null&&(d.value=n==="true"),t!==null&&(s.value=t==="true"),g!==null&&(r.value=g==="true"),V()});const A=()=>{localStorage.setItem("songRepeat",d.value),localStorage.setItem("songAutoplay",s.value),localStorage.setItem("songShuffle",r.value)};I([d,s,r],A),U(()=>{_&&clearInterval(_)});const N={lang:o,extractYoutubeId:a,props:l,isRepeat:d,isAutoplay:s,isShuffle:r,isPlaying:m,currentTime:h,get player(){return f},set player(n){f=n},get timeUpdateInterval(){return _},set timeUpdateInterval(n){_=n},lyricsHTML:F,isLineActive:P,startTimeTracking:w,toggleRepeat:G,toggleAutoplay:J,toggleShuffle:K,handleSongEnded:M,playNextSong:B,navigateToSong:S,initYouTubePlayer:V,createPlayer:b,savePreferences:A,get VText(){return $},get VButton(){return Z},get VContainer(){return X},Breadcrumbs:ee,LanguageSwitcher:te,ref:v,computed:z,onMounted:j,onUnmounted:U,watch:I,get t(){return ae},get toSong(){return E},get toStory(){return ne}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},le={class:"song-page__title"},re={class:"song-page__layout"},ie={class:"song-page__main"},ge={class:"song-page__video-container"},ce=["id"],de={key:0,class:"song-page__karaoke"},ue={class:"song-page__karaoke-title"},_e={class:"song-page__karaoke-content"},ye={class:"song-page__controls-section"},fe={key:1,class:"song-page__story-card"},ve=["href"],he={class:"song-page__story-image"},pe=["src","alt"],me={class:"song-page__story-info"},Se={class:"song-page__story-label"},ke={class:"song-page__story-title"},we={key:2,class:"song-page__lyrics"},be={class:"song-page__lyrics-title"},Te=["innerHTML"],xe={class:"song-page__playlist"},Ie={class:"song-page__playlist-items"},Le=["onClick"],Ce={class:"song-page__playlist-number"},Pe={key:0},Me={key:1,viewBox:"0 0 24 24",fill:"currentColor"},Be={class:"song-page__playlist-cover"},Ve=["src","alt"],Ae={class:"song-page__playlist-info"};function Ne(C,i,o,a,l,d){return u(),oe(a.VContainer,{size:"xl",class:"song-page"},{default:x(()=>[k(a.Breadcrumbs,{"current-page":o.song.name,"saga-name":o.currentSaga?.name,"saga-key":o.currentSaga?.key},null,8,["current-page","saga-name","saga-key"]),k(a.LanguageSwitcher,{order:o.song.order,type:"song",class:"song-page__language-switcher"},null,8,["order"]),e("h1",le,c(o.song.name),1),e("div",re,[e("div",ie,[e("div",ge,[e("div",{id:`youtube-player-${o.song.key}`,class:"song-page__video"},null,8,ce)]),o.song.syncedLyrics&&o.song.syncedLyrics.length>0?(u(),y("div",de,[e("h2",ue,c(a.t("page.song.lyrics")),1),e("div",_e,[(u(!0),y(D,null,O(o.song.syncedLyrics,(s,r)=>(u(),y("div",{key:r,class:p({"song-page__karaoke-line":!0,"song-page__karaoke-line--active":a.isLineActive(s)})},c(s.text),3))),128))])])):L("",!0),e("div",ye,[e("button",{onClick:a.toggleRepeat,class:p([{active:a.isRepeat},"song-page__control"])},[i[0]||(i[0]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M17 1l4 4-4 4M3 11V9a4 4 0 0 1 4-4h14M7 23l-4-4 4-4M21 13v2a4 4 0 0 1-4 4H3"})],-1)),e("span",null,c(a.t("page.song.repeat")),1)],2),e("button",{onClick:a.toggleAutoplay,class:p([{active:a.isAutoplay},"song-page__control"])},[i[1]||(i[1]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M5 3l14 9-14 9V3z"}),e("path",{d:"M19 3v18"})],-1)),e("span",null,c(a.t("page.song.autoplay")),1)],2),e("button",{onClick:a.toggleShuffle,class:p([{active:a.isShuffle},"song-page__control"])},[i[2]||(i[2]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"})],-1)),e("span",null,c(a.t("page.song.shuffle")),1)],2)]),o.relatedStory?(u(),y("div",fe,[e("a",{href:a.toStory(o.relatedStory.key),class:"song-page__story-link"},[e("div",he,[e("img",{src:`/assets/stories/${a.lang}/${o.relatedStory.key}.webp`,alt:o.relatedStory.name},null,8,pe)]),e("div",me,[e("span",Se,c(a.t("page.song.readStory")),1),e("h3",ke,c(o.relatedStory.name),1)]),i[3]||(i[3]=e("svg",{class:"song-page__story-arrow",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"})],-1))],8,ve)])):L("",!0),o.song.lyrics&&(!o.song.syncedLyrics||o.song.syncedLyrics.length===0)?(u(),y("div",we,[e("h2",be,c(a.t("page.song.lyrics")),1),e("div",{class:"song-page__lyrics-content",innerHTML:a.lyricsHTML},null,8,Te)])):L("",!0)]),e("div",xe,[k(a.VText,{variant:"subtitle",color:"high",class:"song-page__playlist-title"},{default:x(()=>[q(c(a.t("page.song.playlist")),1)]),_:1}),e("div",Ie,[(u(!0),y(D,null,O(o.allSongs,(s,r)=>(u(),y("div",{key:s.key,class:p([{"song-page__playlist-item--active":s.key===o.song.key,"song-page__playlist-item--playing":a.isPlaying&&s.key===o.song.key},"song-page__playlist-item"]),onClick:m=>a.navigateToSong(s.key)},[e("div",Ce,[!a.isPlaying||s.key!==o.song.key?(u(),y("span",Pe,c(r+1),1)):(u(),y("svg",Me,[...i[4]||(i[4]=[e("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"},[e("animate",{attributeName:"height",values:"4;16;4",dur:"1.2s",repeatCount:"indefinite",begin:"0s"}),e("animate",{attributeName:"y",values:"10;4;10",dur:"1.2s",repeatCount:"indefinite",begin:"0s"})],-1),e("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"},[e("animate",{attributeName:"height",values:"16;4;16",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"}),e("animate",{attributeName:"y",values:"4;10;4",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"})],-1)])]))]),e("div",Be,[e("img",{src:`/assets/stories/${a.lang}/${s.key}.webp`,alt:s.name},null,8,Ve)]),e("div",Ae,[k(a.VText,{variant:"body",color:"high"},{default:x(()=>[q(c(s.name),1)]),_:2},1024)])],10,Le))),128))])])])]),_:1})}const Ge=W(se,[["render",Ne]]);export{Ge as default};
