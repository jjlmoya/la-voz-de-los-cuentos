import{t as T}from"./index.Br1Li-Ke.js";/* empty css                       */import{_ as j}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{g as _,e as l,j as y,t as w,F as A,h as U,r as p,B as N,f as E,l as I,o as S,n as K,b as x}from"./runtime-core.esm-bundler.BLIdz6c-.js";const P={__name:"StreakCard",setup(O,{expose:h}){h();const m=p(0),a=p([]),D=p(!1),f=p(0),s=()=>{console.log("Storage change detected, recalculating streak..."),f.value++};N(f,()=>{b()}),E(()=>{b(),window.addEventListener("storage",s),window.addEventListener("storage:updated",s)}),I(()=>{window.removeEventListener("storage",s),window.removeEventListener("storage:updated",s)});const d=e=>{try{const t=JSON.parse(localStorage.getItem("storiesData"))||[],n=JSON.parse(localStorage.getItem("songsData"))||[],r=[...t,...n];let c=0;return r.forEach(o=>{if(o&&o.finished){const k=o.completedAt||Date.now(),i=new Date(k);i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0")===e&&c++}}),c}catch(t){return console.error("Error getting completed count:",t),0}},b=()=>{const e=[],t=new Date;for(let n=6;n>=0;n--){const r=new Date(t);r.setDate(r.getDate()-n);const c=r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0"),o=r.toLocaleDateString("en-US",{weekday:"short"}),k=d(c);e.push({date:c,label:n===0?"Today":o,count:k,isToday:n===0})}a.value=e,D.value=e[6].count>0,F()},F=()=>{try{const e=JSON.parse(localStorage.getItem("storiesData"))||[],t=JSON.parse(localStorage.getItem("songsData"))||[],n=[...e,...t],r={};n.forEach(g=>{if(g&&g.finished){const W=g.completedAt||Date.now(),C=new Date(W),M=C.getFullYear()+"-"+String(C.getMonth()+1).padStart(2,"0")+"-"+String(C.getDate()).padStart(2,"0");r[M]||(r[M]=0),r[M]++}});let c=0;const o=new Date,k=o.getFullYear()+"-"+String(o.getMonth()+1).padStart(2,"0")+"-"+String(o.getDate()).padStart(2,"0");let i=new Date(o);for(i.setDate(i.getDate()-1);;){const g=i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0");if(r[g]&&r[g]>0)c++,i.setDate(i.getDate()-1);else break}r[k]&&r[k]>0&&(c+=1),m.value=c}catch(e){console.error("Error updating current streak:",e),m.value=0}},v=["/assets/streak/stickers/s1.webp","/assets/streak/stickers/s2.webp","/assets/streak/stickers/s3.webp","/assets/streak/stickers/s4.webp","/assets/streak/stickers/s5.webp","/assets/streak/stickers/s6.webp","/assets/streak/stickers/s7.webp","/assets/streak/stickers/s8.webp"],u=[{min:0,max:0,image:"/assets/streak/characters/tiny-flame.webp",name:"Tiny Flame"},{min:1,max:1,image:"/assets/streak/characters/tiny-flame.webp",name:"Tiny Flame"},{min:2,max:4,image:"/assets/streak/characters/ember-starter.webp",name:"Ember Starter"},{min:5,max:9,image:"/assets/streak/characters/spark-igniter.webp",name:"Spark Igniter"},{min:10,max:19,image:"/assets/streak/characters/flame-warrior.webp",name:"Flame Warrior"},{min:20,max:39,image:"/assets/streak/characters/blazing-master.webp",name:"Blazing Master"},{min:40,max:59,image:"/assets/streak/characters/inferno-champion.webp",name:"Inferno Champion"},{min:60,max:79,image:"/assets/streak/characters/eternal-flame.webp",name:"Eternal Flame"},{min:80,max:1/0,image:"/assets/streak/characters/cosmic-inferno.webp",name:"Cosmic Inferno"}];function z(e){const t=a.value[e];if(!t)return v[0];const[n,r,c]=t.date.split("-").map(Number),o=(n*1e4+r*100+c)%8;return v[o]}function B(){const e=u.find(t=>m.value>=t.min&&m.value<=t.max);return e?e.image:u[0].image}function R(){const e=u.find(t=>m.value>=t.min&&m.value<=t.max);return e?e.name:u[0].name}function Y(e){const t=Math.sin(e*12.9898+78.233)*43758.5453;return(t-Math.floor(t))*45-22.5}function J(e){const t=Math.sin(e*34.233+45.164)*34748.2384;return(t-Math.floor(t))*20-10}function V(e){if(e.isToday)return T("streak.today");const n={Mon:"streak.mon",Tue:"streak.tue",Wed:"streak.wed",Thu:"streak.thu",Fri:"streak.fri",Sat:"streak.sat",Sun:"streak.sun"}[e.label];return n?T(n):e.label}const L={currentStreak:m,last7Days:a,hasStreakToday:D,updateTrigger:f,handleStorageChange:s,getCompletedCountForDate:d,calculateLast7Days:b,updateCurrentStreak:F,starStickers:v,characterLevels:u,getSticker:z,getCharacterImage:B,getCharacterName:R,getRandomRotation:Y,getRandomOffset:J,getLocalizedDayLabel:V,onMounted:E,onUnmounted:I,ref:p,watch:N,get t(){return T}};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}},q={class:"streak-card__header"},G={class:"streak-card__character"},H=["src","alt"],Q={class:"streak-card__label"},X={class:"streak-card__days"},Z=["src","alt"],$={key:0,class:"streak-card__day-number"},ee={class:"streak-card__day-label"};function te(O,h,m,a,D,f){return S(),_("div",{class:y(["streak-card",{"streak-card--milestone-25":a.currentStreak%25===0&&a.currentStreak>0,"streak-card--milestone-50":a.currentStreak%50===0&&a.currentStreak>0}])},[h[0]||(h[0]=l("div",{class:"streak-card__top-spacing"},null,-1)),l("div",q,[l("div",G,[l("img",{src:a.getCharacterImage(),alt:a.getCharacterName(),class:"streak-card__character-img"},null,8,H)]),l("div",{class:y(["streak-card__number",{"streak-card__number--pulse-intense":a.currentStreak%25===0&&a.currentStreak>0,"streak-card__number--frozen":!a.hasStreakToday&&a.currentStreak>0,"streak-card__number--burning":a.hasStreakToday}])},w(a.currentStreak),3),l("div",Q,w(a.t("streak.label")),1)]),l("div",X,[(S(!0),_(A,null,U(a.last7Days,(s,d)=>(S(),_("div",{key:d,class:y(["streak-card__day-wrapper",{"streak-card__day-wrapper--second-row":d>=4}]),style:K({"--delay":`${d*.15}s`,"--rotation":`${a.getRandomRotation(d)}deg`,"--offset":`${a.getRandomOffset(d)}px`})},[s.count>0?(S(),_("img",{key:0,src:a.getSticker(d),alt:`sticker-${d}`,class:"streak-card__sticker streak-card__day-img--drop"},null,8,Z)):x("",!0),l("div",{class:y(["streak-card__day-dot",{"streak-card__day-dot--empty":s.count===0,"streak-card__day-dot--one":s.count===1,"streak-card__day-dot--epic":s.count>1,"streak-card__day-dot--today":s.isToday}])},[s.count>1?(S(),_("span",$,w(s.count),1)):x("",!0)],2),l("div",ee,w(a.getLocalizedDayLabel(s)),1)],6))),128))])],2)}const oe=j(P,[["render",te],["__scopeId","data-v-f5423cb8"]]);export{oe as default};
