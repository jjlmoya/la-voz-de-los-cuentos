import{w as ge,T as ce}from"./runtime-dom.esm-bundler.0lIbTe_P.js";import{o as _e,a as pe,c as F}from"./achievementEvents.DHKWVqNG.js";import{r as N,ac as $,c as ke,o as m,a as M,w as re,g as v,b as y,e as c,t as f,n as G,F as z,h as Q,m as le,ae as ye,j as S,d as L,p as be,f as ee,af as te}from"./runtime-core.esm-bundler.OheDorFq.js";import{f as ne}from"./index.Dj5k6ggm.js";import{t as K}from"./index.BBvPNGtS.js";import{_ as X}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{u as se,A as _,c as ae,s as q,i as b,a as g}from"./useAchievements.DYniAc26.js";import{b as Ae,c as Ce}from"./index.CqFlbLC_.js";import"./useStories.D0wU7qQi.js";import"./useStory.UFTN_M2T.js";import"./landings.D6rrVUZj.js";const k=N(null),D=N([]);let O=!1,P=null,U=null;function R(){function r(){n(),P=_e(a=>{a.isNew&&i({id:a.achievement.id,nameKey:a.achievement.nameKey,descriptionKey:a.achievement.descriptionKey,iconId:a.achievement.iconId,type:"unlock"})}),U=pe(a=>{[25,50,75,100].includes(a.progress)&&a.isNew&&i({id:a.achievementId,nameKey:"achievement.progress",descriptionKey:"achievement.progress.description",iconId:"progress-indicator",type:"progress",progress:a.progress,current:a.current,target:a.target})})}function n(){P&&(P(),P=null),U&&(U(),U=null)}function i(a){const h={id:`${a.id}-${Date.now()}`,data:a,timestamp:Date.now()};D.value.push(h),e()}function e(){if(O||D.value.length===0)return;O=!0;const a=D.value.shift();if(a){a.displayedAt=Date.now(),k.value=a;const h=a.data.type==="unlock"?4e3:2e3;setTimeout(()=>{t()},h)}}function t(){k.value=null,O=!1,D.value.length>0&&setTimeout(()=>{e()},300)}function o(){t()}function s(){k.value=null,D.value=[],O=!1}function l(){return k.value?{...k.value.data,displayDuration:k.value.displayedAt?Date.now()-k.value.displayedAt:0}:null}return{currentNotification:$(k),pendingNotifications:$(D),showNotification:i,closeNotification:t,dismiss:o,clearAll:s,getCurrentNotification:l,setupEventListeners:r,teardownEventListeners:n}}let j=null;function oe(){return j||(j=R(),j.setupEventListeners()),j}const Se={__name:"AchievementUnlock",setup(r,{expose:n}){n();const{currentNotification:i,dismiss:e}=R(),t=S(()=>i.value?.data||null),o=S(()=>t.value?K(t.value.nameKey):""),s=S(()=>t.value?K(t.value.descriptionKey):""),l=S(()=>({"achievement-unlock-v2__container--progress":t.value?.type==="progress","achievement-unlock-v2__container--unlock":t.value?.type==="unlock"})),a=S(()=>ne());function h(u,d){return u?`/assets/achievements/${d?.folder||"read"}/${u}.png`:"/assets/account/get-achievement.webp"}function I(u){console.warn("Failed to load achievement icon:",u.target.src),u.target.style.display="none"}function V(u){const p=Array.from({length:12},(fe,J)=>J*360/12)[u-1],C=u*.05%.6;return{"--angle":p,"--delay":`${C}s`,animationDelay:`${C}s`}}function W(u){const p=Array.from({length:6},(fe,J)=>J*360/6)[u-1],C=u*.1%.5;return{"--angle":p,"--delay":`${C}s`,animationDelay:`${C}s`}}const T={currentNotification:i,dismiss:e,notification:t,notificationName:o,notificationDescription:s,containerClasses:l,achievementsLink:a,getIconPath:h,handleImageError:I,getConfettiStyle:V,getSparkStyle:W,handleClose:()=>{e()},computed:S,get useAchievementNotification(){return R},get toAccountAchievements(){return ne},get t(){return K}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}},we={class:"achievement-unlock-v2__image-wrapper"},Ne={key:0,class:"achievement-unlock-v2__icon-frame"},Ee=["src","alt"],Ie={key:0,class:"achievement-unlock-v2__shine"},De={key:1,src:"/assets/account/get-achievement.webp",alt:"Achievement Unlocked",class:"achievement-unlock-v2__fallback-image"},Te={class:"achievement-unlock-v2__content"},Ke={class:"achievement-unlock-v2__label"},Le={class:"achievement-unlock-v2__title"},Oe={class:"achievement-unlock-v2__description"},Pe={key:0,class:"achievement-unlock-v2__progress"},Ue={class:"achievement-unlock-v2__progress-bar"},je={class:"achievement-unlock-v2__progress-text"},Fe=["href"];function qe(r,n,i,e,t,o){return m(),ke(ye,{to:"body"},[M(ce,{name:"achievement-unlock-v2"},{default:re(()=>[e.currentNotification?(m(),v("div",{key:0,class:"achievement-unlock-v2",onClick:ge(e.handleClose,["self"])},[c("div",{class:le(["achievement-unlock-v2__container",e.containerClasses])},[n[0]||(n[0]=c("div",{class:"achievement-unlock-v2__bg-glow"},null,-1)),c("div",we,[e.notification?(m(),v("div",Ne,[c("img",{src:e.getIconPath(e.notification.iconId),alt:e.notification.nameEs,class:"achievement-unlock-v2__icon",onError:e.handleImageError},null,40,Ee),e.notification.type==="unlock"?(m(),v("div",Ie)):y("",!0)])):y("",!0),!e.notification||!e.notification.iconId?(m(),v("img",De)):y("",!0)]),c("div",Te,[c("p",Ke,f(e.notification?.type==="unlock"?e.t("achievement.unlocked"):e.t("achievement.progress")||"Progreso"),1),c("h2",Le,f(e.notificationName),1),c("p",Oe,f(e.notificationDescription),1),e.notification?.type==="progress"?(m(),v("div",Pe,[c("div",Ue,[c("div",{class:"achievement-unlock-v2__progress-fill",style:G({width:`${e.notification.progress}%`})},null,4)]),c("p",je,f(e.notification.current)+"/"+f(e.notification.target),1)])):y("",!0)]),e.notification?.type==="unlock"?(m(),v("a",{key:0,href:e.achievementsLink,class:"achievement-unlock-v2__button",onClick:e.handleClose},f(e.t("achievement.view")),9,Fe)):y("",!0),(m(),v(z,null,Q(12,s=>c("div",{key:s,class:"achievement-unlock-v2__confetti",style:G(e.getConfettiStyle(s))},null,4)),64)),(m(),v(z,null,Q(6,s=>c("div",{key:`spark-${s}`,class:"achievement-unlock-v2__spark",style:G(e.getSparkStyle(s))},null,4)),64))],2)])):y("",!0)]),_:1})])}const xe=X(Se,[["render",qe],["__scopeId","data-v-1c7bf41d"]]),Me={__name:"AchievementDebug",setup(r,{expose:n}){n();const i=!1,e=N(!1),{allAchievements:t,unlockedAchievements:o,lockedAchievements:s,stats:l,recalculateAll:a}=se();function h(u){return K(u.nameKey)}function I(u){const d=_.find(C=>C.id===u);if(!d)return;const p=new Date;q(u,p),F({achievement:{id:d.id,type:d.type,nameKey:d.nameKey,descriptionKey:d.descriptionKey,iconId:d.iconId,unlocked:!0,unlockedAt:p,threshold:d.threshold,metadata:d.metadata},unlockedAt:p,isNew:!0}),a()}function V(){confirm("¿Estás seguro de que quieres limpiar todos los logros?")&&(ae(),a())}function W(){confirm("¿Estás seguro de que quieres desbloquear todos los logros?")&&(_.forEach(u=>{const d=new Date;q(u.id,d),F({achievement:{id:u.id,type:u.type,nameKey:u.nameKey,descriptionKey:u.descriptionKey,iconId:u.iconId,unlocked:!0,unlockedAt:d,threshold:u.threshold,metadata:u.metadata},unlockedAt:d,isNew:!0})}),a())}function Z(){console.log({total:t.value.length,unlocked:o.value.length,locked:s.value.length,progress:l.value.progressPercentage+"%",achievements:t.value})}const T={isDev:i,isOpen:e,allAchievements:t,unlockedAchievements:o,lockedAchievements:s,stats:l,recalculateAll:a,getAchievementName:h,simulateAchievementUnlock:I,clearAllAchievements:V,unlockAllAchievements:W,showAchievementsInfo:Z,ref:N,computed:S,get useAchievements(){return se},get saveAchievementUnlock(){return q},get clearAchievements(){return ae},get emitAchievementUnlock(){return F},get ALL_ACHIEVEMENT_DEFINITIONS(){return _},get t(){return K}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}},ze={key:0,class:"achievement-debug"},Be={key:0,class:"achievement-debug__panel"},Ve={class:"achievement-debug__header"},We={class:"achievement-debug__section"},Je={class:"achievement-debug__list"},Ge=["onClick"],He={class:"achievement-debug__achievement-name"},Qe={key:0,class:"achievement-debug__badge"},Re={key:1,class:"achievement-debug__badge achievement-debug__badge--locked"},Xe={class:"achievement-debug__section"},Ye={class:"achievement-debug__info"};function Ze(r,n,i,e,t,o){return e.isDev?(m(),v("div",ze,[c("button",{class:"achievement-debug__toggle",onClick:n[0]||(n[0]=s=>e.isOpen=!e.isOpen)}," 🐛 "),M(ce,{name:"debug-slide"},{default:re(()=>[e.isOpen?(m(),v("div",Be,[c("div",Ve,[n[2]||(n[2]=c("h3",null,"Sistema de Logros - Debug",-1)),c("button",{class:"achievement-debug__close",onClick:n[1]||(n[1]=s=>e.isOpen=!1)},"✕")]),c("div",We,[n[3]||(n[3]=c("h4",null,"Logros Disponibles",-1)),c("div",Je,[(m(!0),v(z,null,Q(e.allAchievements,s=>(m(),v("button",{key:s.id,class:le(["achievement-debug__achievement-btn",{"achievement-debug__achievement-btn--unlocked":s.unlocked}]),onClick:l=>e.simulateAchievementUnlock(s.id)},[c("span",He,f(e.getAchievementName(s)),1),s.unlocked?(m(),v("span",Qe,"✓ Desbloqueado")):(m(),v("span",Re,"🔒 Bloqueado"))],10,Ge))),128))])]),c("div",{class:"achievement-debug__section"},[n[4]||(n[4]=c("h4",null,"Utilidades",-1)),c("div",{class:"achievement-debug__utilities"},[c("button",{class:"achievement-debug__btn achievement-debug__btn--info",onClick:e.showAchievementsInfo}," 📊 Ver Info "),c("button",{class:"achievement-debug__btn achievement-debug__btn--warning",onClick:e.clearAllAchievements}," 🗑️ Limpiar Todo "),c("button",{class:"achievement-debug__btn achievement-debug__btn--success",onClick:e.unlockAllAchievements}," 🎯 Desbloquear Todo ")])]),c("div",Xe,[n[9]||(n[9]=c("h4",null,"Estado Actual",-1)),c("div",Ye,[c("p",null,[n[5]||(n[5]=c("strong",null,"Total:",-1)),L(" "+f(e.allAchievements.length),1)]),c("p",null,[n[6]||(n[6]=c("strong",null,"Desbloqueados:",-1)),L(" "+f(e.unlockedAchievements.length),1)]),c("p",null,[n[7]||(n[7]=c("strong",null,"Bloqueados:",-1)),L(" "+f(e.lockedAchievements.length),1)]),c("p",null,[n[8]||(n[8]=c("strong",null,"Progreso:",-1)),L(" "+f(Math.round(e.stats.progressPercentage))+"%",1)])])])])):y("",!0)]),_:1})])):y("",!0)}const $e=X(Me,[["render",Ze],["__scopeId","data-v-b915d4c7"]]),w=N([]),x=N([]);function Y(){try{w.value=Ae(),x.value=Ce()}catch{}}const B=N([]);let H=!1;function E(){if(typeof window>"u")return[];try{const r=localStorage.getItem("storiesData");return r?JSON.parse(r):[]}catch{return[]}}function et(){const r=E(),n=B.value;let i=!1,e=!1;r.forEach(t=>{const o=n.find(I=>I.key===t.key),s=t.spentTime>=parseFloat(String(t.totalTime)),l=o&&o.spentTime>=parseFloat(String(o.totalTime));s&&!l&&(i=!0);const a=t.like===!0,h=o&&o.like===!0;a!==h&&(e=!0)}),i&&ue(),e&&he(),(i||e)&&(de(),me(),ve()),B.value=JSON.parse(JSON.stringify(r))}function ue(){const n=E().filter(e=>e.spentTime>=parseFloat(String(e.totalTime))).length;_.filter(e=>e.type==="read").forEach(e=>{const t=e.threshold||1;n>=t&&!b(e.id)&&A(e.id),g(e.id,n,t)})}function he(){const n=E().filter(e=>e.like===!0).length;_.filter(e=>e.type==="favorite").forEach(e=>{const t=e.threshold||1;n>=t&&!b(e.id)&&A(e.id),g(e.id,n,t)})}function de(){try{w.value.length===0&&Y();const r=E().filter(t=>t.spentTime>=parseFloat(String(t.totalTime))),n={};r.forEach(t=>{const o=w.value.find(s=>s.key===t.key);o?.saga&&o.saga.trim()!==""&&(n[o.saga]=(n[o.saga]||0)+1)});const i={};w.value.forEach(t=>{t.saga&&t.saga.trim()!==""&&(i[t.saga]=(i[t.saga]||0)+1)}),_.filter(t=>t.type==="saga").forEach(t=>{const o=t.threshold||1;if(t.id.startsWith("saga-")&&t.id!=="saga-all"){const s=Object.keys(n).length;s>=o&&!b(t.id)&&A(t.id),g(t.id,Math.min(s,o),o)}else if(t.id==="saga-all"){let s=!1,l=0;Object.entries(i).forEach(([a,h])=>{(n[a]||0)===h&&l++}),s=l===Object.keys(i).length&&Object.keys(i).length>0,s&&!b("saga-all")&&A("saga-all"),g("saga-all",s?1:0,1)}})}catch{}}function me(){try{(x.value.length===0||w.value.length===0)&&Y();const r=E().filter(t=>t.spentTime>=parseFloat(String(t.totalTime))),n={};r.forEach(t=>{const o=w.value.find(s=>s.key===t.key);o?.saga&&o.saga.trim()!==""&&x.value.filter(l=>l.saga===o.saga).forEach(l=>{n[l.key]||(n[l.key]=new Set),n[l.key].add(t.key)})});const i={};w.value.forEach(t=>{t.saga&&t.saga.trim()!==""&&x.value.filter(s=>s.saga===t.saga).forEach(s=>{i[s.key]||(i[s.key]=new Set),i[s.key].add(t.key)})}),_.filter(t=>t.type==="character").forEach(t=>{const o=t.threshold||1;if(t.id==="char-5"){Object.entries(n).some(([a,h])=>h.size>=5)&&!b("char-5")&&A("char-5");const l=Math.max(...Object.values(n).map(a=>a.size),0);g("char-5",Math.min(l,o),o)}else if(t.id==="char-10"){Object.entries(n).some(([a,h])=>h.size>=10)&&!b("char-10")&&A("char-10");const l=Math.max(...Object.values(n).map(a=>a.size),0);g("char-10",Math.min(l,o),o)}else if(t.id==="char-all"){const s=Object.entries(i).some(([l,a])=>(n[l]?.size||0)===a.size&&a.size>0);s&&!b("char-all")&&A("char-all"),g("char-all",s?1:0,1)}else if(t.id==="char-profiles"){const s=Object.entries(n).filter(([l,a])=>a.size>0).length;s>=o&&!b("char-profiles")&&A("char-profiles"),g("char-profiles",Math.min(s,o),o)}})}catch{}}function ve(){try{const n=E().filter(e=>e.spentTime>=parseFloat(String(e.totalTime))).length;_.filter(e=>e.type==="special").forEach(e=>{g(e.id,0,1)})}catch{}}function A(r){const n=_.find(e=>e.id===r);if(!n)return;const i=new Date;q(r,i),F({achievement:{id:n.id,type:n.type,nameKey:n.nameKey,descriptionKey:n.descriptionKey,iconId:n.iconId,unlocked:!0,unlockedAt:i,threshold:n.threshold,metadata:n.metadata},unlockedAt:i,isNew:!0})}function ie(){function r(){if(H)return()=>{};H=!0,B.value=E(),Y();const e=setInterval(()=>{et()},2e3);return()=>{clearInterval(e),H=!1}}function n(){ue(),he(),de(),me(),ve()}function i(){B.value=[]}return{startListening:r,forceCheck:n,resetCache:i}}const tt={__name:"AchievementListenerProvider",setup(r,{expose:n}){n();const{startListening:i,forceCheck:e}=ie(),{setupEventListeners:t}=oe();ee(()=>{const s=i();t(),e(),window.__achievementCleanup=()=>{s()}}),te(()=>{window.__achievementCleanup&&window.__achievementCleanup()});const o={startListening:i,forceCheck:e,setupEventListeners:t,onMounted:ee,onBeforeUnmount:te,AchievementUnlock:xe,AchievementDebug:$e,get useAchievementListener(){return ie},get getGlobalAchievementNotification(){return oe}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}};function nt(r,n,i,e,t,o){return m(),v(z,null,[be(r.$slots,"default"),M(e.AchievementUnlock),M(e.AchievementDebug)],64)}const vt=X(tt,[["render",nt]]);export{vt as default};
