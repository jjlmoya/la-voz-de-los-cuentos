import{o as N,a as _,b as P}from"./achievementEvents.DHKWVqNG.js";import{u as H}from"./useStories.D0wU7qQi.js";import{r as I,j as h,ac as m}from"./runtime-core.esm-bundler.OheDorFq.js";const R=[{id:"read-1",type:"read",nameKey:"achievement.read-1.name",descriptionKey:"achievement.read-1.description",iconId:"1",threshold:1,metadata:{folder:"read"}},{id:"read-5",type:"read",nameKey:"achievement.read-5.name",descriptionKey:"achievement.read-5.description",iconId:"5",threshold:5,metadata:{folder:"read"}},{id:"read-25",type:"read",nameKey:"achievement.read-25.name",descriptionKey:"achievement.read-25.description",iconId:"25",threshold:25,metadata:{folder:"read"}},{id:"read-50",type:"read",nameKey:"achievement.read-50.name",descriptionKey:"achievement.read-50.description",iconId:"50",threshold:50,metadata:{folder:"read"}},{id:"read-100",type:"read",nameKey:"achievement.read-100.name",descriptionKey:"achievement.read-100.description",iconId:"100",threshold:100,metadata:{folder:"read"}},{id:"read-200",type:"read",nameKey:"achievement.read-200.name",descriptionKey:"achievement.read-200.description",iconId:"200",threshold:200,metadata:{folder:"read"}}],V=[{id:"fav-1",type:"favorite",nameKey:"achievement.fav-1.name",descriptionKey:"achievement.fav-1.description",iconId:"1",threshold:1,metadata:{folder:"fav"}},{id:"fav-5",type:"favorite",nameKey:"achievement.fav-5.name",descriptionKey:"achievement.fav-5.description",iconId:"5",threshold:5,metadata:{folder:"fav"}},{id:"fav-10",type:"favorite",nameKey:"achievement.fav-10.name",descriptionKey:"achievement.fav-10.description",iconId:"10",threshold:10,metadata:{folder:"fav"}},{id:"fav-25",type:"favorite",nameKey:"achievement.fav-25.name",descriptionKey:"achievement.fav-25.description",iconId:"25",threshold:25,metadata:{folder:"fav"}},{id:"fav-50",type:"favorite",nameKey:"achievement.fav-50.name",descriptionKey:"achievement.fav-50.description",iconId:"50",threshold:50,metadata:{folder:"fav"}}],B=[{id:"saga-1",type:"saga",nameKey:"achievement.saga-1.name",descriptionKey:"achievement.saga-1.description",iconId:"1",threshold:1,metadata:{folder:"read-saga"}},{id:"saga-3",type:"saga",nameKey:"achievement.saga-3.name",descriptionKey:"achievement.saga-3.description",iconId:"3",threshold:3,metadata:{folder:"read-saga"}},{id:"saga-7",type:"saga",nameKey:"achievement.saga-7.name",descriptionKey:"achievement.saga-7.description",iconId:"7",threshold:7,metadata:{folder:"read-saga"}},{id:"saga-all",type:"saga",nameKey:"achievement.saga-all.name",descriptionKey:"achievement.saga-all.description",iconId:"all",threshold:11,metadata:{folder:"read-saga"}}],O=[{id:"char-5",type:"character",nameKey:"achievement.char-5.name",descriptionKey:"achievement.char-5.description",iconId:"5",threshold:5,metadata:{folder:"read-character"}},{id:"char-10",type:"character",nameKey:"achievement.char-10.name",descriptionKey:"achievement.char-10.description",iconId:"10",threshold:10,metadata:{folder:"read-character"}},{id:"char-all",type:"character",nameKey:"achievement.char-all.name",descriptionKey:"achievement.char-all.description",iconId:"all",threshold:20,metadata:{folder:"read-character"}},{id:"char-profiles",type:"character",nameKey:"achievement.char-profiles.name",descriptionKey:"achievement.char-profiles.description",iconId:"profiles",threshold:25,metadata:{folder:"read-character"}}],q=[{id:"special-all",type:"special",nameKey:"achievement.special-all.name",descriptionKey:"achievement.special-all.description",iconId:"all",threshold:1,metadata:{folder:"read-special"}},{id:"special-epic",type:"special",nameKey:"achievement.special-epic.name",descriptionKey:"achievement.special-epic.description",iconId:"epic",threshold:1,metadata:{folder:"read-special"}},{id:"special-quick",type:"special",nameKey:"achievement.special-quick.name",descriptionKey:"achievement.special-quick.description",iconId:"quick",threshold:1,metadata:{folder:"read-special"}},{id:"special-oldest",type:"special",nameKey:"achievement.special-oldest.name",descriptionKey:"achievement.special-oldest.description",iconId:"oldest",threshold:1,metadata:{folder:"read-special"}},{id:"special-newest",type:"special",nameKey:"achievement.special-newest.name",descriptionKey:"achievement.special-newest.description",iconId:"newest",threshold:1,metadata:{folder:"read-special"}},{id:"special-early",type:"special",nameKey:"achievement.special-early.name",descriptionKey:"achievement.special-early.description",iconId:"early",threshold:1,metadata:{folder:"read-special"}},{id:"special-night",type:"special",nameKey:"achievement.special-night.name",descriptionKey:"achievement.special-night.description",iconId:"night",threshold:1,metadata:{folder:"read-special"}}],u=[...R,...V,...B,...O,...q],y="achievements_state";function p(){if(typeof window>"u")return{};try{const n=localStorage.getItem(y);if(!n)return{};const r=JSON.parse(n);return r.version!==1?{}:r.achievements||{}}catch{return{}}}function F(n,r){const c=p();c[n]={id:n,unlocked:!0,unlockedAt:r.getTime()},g(c)}function L(n,r,c){const o=p(),v=o[n]||{id:n,unlocked:!1};o[n]={...v,progress:Math.round(r/c*100),current:r,target:c},g(o)}function f(n){return p()[n]||null}function x(n){return f(n)?.unlocked??!1}function G(n){const r=p();r[n]&&(r[n]={...r[n],unlocked:!1,unlockedAt:void 0}),g(r)}function Y(){typeof window>"u"||localStorage.removeItem(y)}function g(n){if(typeof window>"u")return;const r={version:1,achievements:n,lastUpdated:Date.now()};try{localStorage.setItem(y,JSON.stringify(r))}catch{}}function $(){const{getCompleteStories:n,getFavoriteStories:r}=H(),c=I(0),o=I({});N(e=>{c.value++,o.value={...o.value}}),_(e=>{c.value++,o.value={...o.value}}),P(()=>{T(),c.value++,o.value={...o.value}});function v(e){const t=u.find(i=>i.id===e);if(!t)throw new Error(`Achievement definition not found: ${e}`);const a=f(e);return{id:e,type:t.type,nameKey:t.nameKey,descriptionKey:t.descriptionKey,iconId:t.iconId,unlocked:a?.unlocked??!1,unlockedAt:a?.unlockedAt?new Date(a.unlockedAt):void 0,threshold:t.threshold,metadata:t.metadata}}function l(e){const t=u.find(i=>i.id===e);if(!t?.threshold)return null;const a=f(e);if(t.type==="read"){const i=n().length,s=t.threshold;return{current:i,target:s,progress:Math.min(100,i/s*100)}}if(t.type==="favorite"){const i=r().length,s=t.threshold;return{current:i,target:s,progress:Math.min(100,i/s*100)}}return a?.current!==void 0&&a?.target!==void 0?{current:a.current,target:a.target,progress:a.progress??Math.min(100,a.current/a.target*100)}:null}function E(e){const t=v(e),a=l(e);return{...t,progress:a?.progress??0,current:a?.current,target:a?.target,nearUnlock:a?a.progress>=80&&a.progress<100:!1}}const d=h(()=>(c.value,o.value,u.map(e=>E(e.id)))),K=h(()=>d.value.filter(e=>e.unlocked)),S=h(()=>d.value.filter(e=>!e.unlocked)),w=h(()=>{const e=d.value,t=K.value,a=e.length;return{totalAchievements:a,unlockedCount:t.length,lockedCount:a-t.length,progressPercentage:Math.round(t.length/a*100),totalProgress:Math.round(e.reduce((i,s)=>i+s.progress,0)/a),recentUnlocks:t.sort((i,s)=>{const D=i.unlockedAt?.getTime()??0;return(s.unlockedAt?.getTime()??0)-D}).slice(0,5)}});function A(e){if(x(e))return!1;const a=l(e);return a&&a.current>=a.target?(F(e,new Date),c.value++,!0):!1}function k(e){const t=l(e);t&&(L(e,t.current,t.target),c.value++)}function T(){d.value.forEach(e=>{if(!e.unlocked)return;const t=l(e.id);t&&t.current<t.target&&G(e.id)})}function C(){d.value.forEach(e=>{A(e.id),k(e.id)})}function M(e){return d.value.find(t=>t.id===e)}function U(e){return d.value.filter(t=>t.type===e)}return{allAchievements:m(d),unlockedAchievements:m(K),lockedAchievements:m(S),stats:m(w),checkAndUnlockAchievement:A,updateProgress:k,recalculateAll:C,getAchievement:M,getAchievementsByTypeFilter:U}}export{u as A,L as a,Y as c,x as i,F as s,$ as u};
