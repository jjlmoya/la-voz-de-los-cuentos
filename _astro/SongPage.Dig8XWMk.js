import{_ as W,g as X,w as Z,I as $}from"./_plugin-vue_export-helper.Du-30fKt.js";import{B as ee}from"./Breadcrumbs.DMU8-y9q.js";import{t as te}from"./index.ZkgYVdYK.js";import{a as ae,b as E}from"./index.BMPHkLeA.js";/* empty css                      */import{c as ne,w as T,r as v,j as z,k as x,h as j,l as U,o as u,a as I,e,t as c,f as y,b as C,F as D,g as O,m as p,d as q}from"./runtime-dom.esm-bundler.C3DI30_X.js";/* empty css                      */const oe={__name:"SongPage",props:{song:{type:Object,required:!0},allSongs:{type:Array,default:()=>[]},currentSaga:{type:Object,default:null},relatedStory:{type:Object,default:null}},setup(L,{expose:i}){i();const o="es",a=n=>{if(!n)return"";const t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,g=n.match(t);return g&&g[2].length===11?g[2]:n},l=L,d=v(!1),s=v(!0),r=v(!1),m=v(!1),h=v(0);let f=null,_=null;const F=z(()=>l.song.lyrics?l.song.lyrics.replace(/<br\s*\/?>/gi,`
`).replace(/\n{3,}/g,`

`).replace(/\n/g,"<br>"):""),P=n=>h.value>=n.start&&h.value<n.end;x(h,()=>{if(!l.song.syncedLyrics||l.song.syncedLyrics.length===0)return;const n=l.song.syncedLyrics.findIndex(t=>P(t));if(n!==-1){const t=document.querySelector(".song-page__karaoke-content"),g=document.querySelectorAll(".song-page__karaoke-line")[n];if(t&&g){const H=t.scrollTop,R=t.clientHeight,b=g.offsetTop-t.offsetTop,Y=g.clientHeight,Q=b-R/2+Y/2;(b<H||b+Y>H+R)&&t.scrollTo({top:Q,behavior:"smooth"})}}});const k=()=>{_&&clearInterval(_),_=setInterval(()=>{f&&typeof f.getCurrentTime=="function"&&(h.value=f.getCurrentTime())},100)},G=()=>{d.value=!d.value,d.value&&(s.value=!1,r.value=!1)},J=()=>{s.value=!s.value,s.value&&(d.value=!1)},K=()=>{r.value=!r.value,r.value&&(d.value=!1)},M=()=>{d.value?f?.playVideo():s.value&&B()},B=()=>{const n=l.allSongs.findIndex(t=>t.key===l.song.key);if(r.value){let t;do t=Math.floor(Math.random()*l.allSongs.length);while(t===n&&l.allSongs.length>1);const g=l.allSongs[t];S(g.key)}else if(n!==-1)if(n<l.allSongs.length-1){const t=l.allSongs[n+1];S(t.key)}else{const t=l.allSongs[0];S(t.key)}},S=n=>{window.location.href=E(n)},V=()=>{if(window.YT)w();else{const n=document.createElement("script");n.src="https://www.youtube.com/iframe_api";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t),window.onYouTubeIframeAPIReady=w}},w=()=>{const n=a(l.song.song);f=new window.YT.Player(`youtube-player-${l.song.key}`,{videoId:n,width:"100%",height:"100%",playerVars:{autoplay:1,rel:0,modestbranding:1,cc_load_policy:1},events:{onReady:t=>{window.__ytPlayer=t.target,k()},onStateChange:t=>{t.data===window.YT.PlayerState.ENDED&&M(),t.data===window.YT.PlayerState.PLAYING&&(m.value=!0,k()),t.data===window.YT.PlayerState.PAUSED&&_&&clearInterval(_)}}})};j(()=>{m.value=!0;const n=localStorage.getItem("songRepeat"),t=localStorage.getItem("songAutoplay"),g=localStorage.getItem("songShuffle");n!==null&&(d.value=n==="true"),t!==null&&(s.value=t==="true"),g!==null&&(r.value=g==="true"),V()});const A=()=>{localStorage.setItem("songRepeat",d.value),localStorage.setItem("songAutoplay",s.value),localStorage.setItem("songShuffle",r.value)};x([d,s,r],A),U(()=>{_&&clearInterval(_)});const N={lang:o,extractYoutubeId:a,props:l,isRepeat:d,isAutoplay:s,isShuffle:r,isPlaying:m,currentTime:h,get player(){return f},set player(n){f=n},get timeUpdateInterval(){return _},set timeUpdateInterval(n){_=n},lyricsHTML:F,isLineActive:P,startTimeTracking:k,toggleRepeat:G,toggleAutoplay:J,toggleShuffle:K,handleSongEnded:M,playNextSong:B,navigateToSong:S,initYouTubePlayer:V,createPlayer:w,savePreferences:A,get VText(){return $},get VButton(){return Z},get VContainer(){return X},Breadcrumbs:ee,ref:v,computed:z,onMounted:j,onUnmounted:U,watch:x,get t(){return te},get toSong(){return E},get toStory(){return ae}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},se={class:"song-page__title"},le={class:"song-page__layout"},re={class:"song-page__main"},ie={class:"song-page__video-container"},ge=["id"],ce={key:0,class:"song-page__karaoke"},de={class:"song-page__karaoke-title"},ue={class:"song-page__karaoke-content"},_e={class:"song-page__controls-section"},ye={key:1,class:"song-page__story-card"},fe=["href"],ve={class:"song-page__story-image"},he=["src","alt"],pe={class:"song-page__story-info"},me={class:"song-page__story-label"},Se={class:"song-page__story-title"},ke={key:2,class:"song-page__lyrics"},we={class:"song-page__lyrics-title"},be=["innerHTML"],Te={class:"song-page__playlist"},xe={class:"song-page__playlist-items"},Ie=["onClick"],Ce={class:"song-page__playlist-number"},Le={key:0},Pe={key:1,viewBox:"0 0 24 24",fill:"currentColor"},Me={class:"song-page__playlist-cover"},Be=["src","alt"],Ve={class:"song-page__playlist-info"};function Ae(L,i,o,a,l,d){return u(),ne(a.VContainer,{size:"xl",class:"song-page"},{default:T(()=>[I(a.Breadcrumbs,{"current-page":o.song.name,"saga-name":o.currentSaga?.name,"saga-key":o.currentSaga?.key},null,8,["current-page","saga-name","saga-key"]),e("h1",se,c(o.song.name),1),e("div",le,[e("div",re,[e("div",ie,[e("div",{id:`youtube-player-${o.song.key}`,class:"song-page__video"},null,8,ge)]),o.song.syncedLyrics&&o.song.syncedLyrics.length>0?(u(),y("div",ce,[e("h2",de,c(a.t("page.song.lyrics")),1),e("div",ue,[(u(!0),y(D,null,O(o.song.syncedLyrics,(s,r)=>(u(),y("div",{key:r,class:p({"song-page__karaoke-line":!0,"song-page__karaoke-line--active":a.isLineActive(s)})},c(s.text),3))),128))])])):C("",!0),e("div",_e,[e("button",{onClick:a.toggleRepeat,class:p([{active:a.isRepeat},"song-page__control"])},[i[0]||(i[0]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M17 1l4 4-4 4M3 11V9a4 4 0 0 1 4-4h14M7 23l-4-4 4-4M21 13v2a4 4 0 0 1-4 4H3"})],-1)),e("span",null,c(a.t("page.song.repeat")),1)],2),e("button",{onClick:a.toggleAutoplay,class:p([{active:a.isAutoplay},"song-page__control"])},[i[1]||(i[1]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M5 3l14 9-14 9V3z"}),e("path",{d:"M19 3v18"})],-1)),e("span",null,c(a.t("page.song.autoplay")),1)],2),e("button",{onClick:a.toggleShuffle,class:p([{active:a.isShuffle},"song-page__control"])},[i[2]||(i[2]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"})],-1)),e("span",null,c(a.t("page.song.shuffle")),1)],2)]),o.relatedStory?(u(),y("div",ye,[e("a",{href:a.toStory(o.relatedStory.key),class:"song-page__story-link"},[e("div",ve,[e("img",{src:`/assets/stories/${a.lang}/${o.relatedStory.key}.webp`,alt:o.relatedStory.name},null,8,he)]),e("div",pe,[e("span",me,c(a.t("page.song.readStory")),1),e("h3",Se,c(o.relatedStory.name),1)]),i[3]||(i[3]=e("svg",{class:"song-page__story-arrow",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"})],-1))],8,fe)])):C("",!0),o.song.lyrics&&(!o.song.syncedLyrics||o.song.syncedLyrics.length===0)?(u(),y("div",ke,[e("h2",we,c(a.t("page.song.lyrics")),1),e("div",{class:"song-page__lyrics-content",innerHTML:a.lyricsHTML},null,8,be)])):C("",!0)]),e("div",Te,[I(a.VText,{variant:"subtitle",color:"high",class:"song-page__playlist-title"},{default:T(()=>[q(c(a.t("page.song.playlist")),1)]),_:1}),e("div",xe,[(u(!0),y(D,null,O(o.allSongs,(s,r)=>(u(),y("div",{key:s.key,class:p([{"song-page__playlist-item--active":s.key===o.song.key,"song-page__playlist-item--playing":a.isPlaying&&s.key===o.song.key},"song-page__playlist-item"]),onClick:m=>a.navigateToSong(s.key)},[e("div",Ce,[!a.isPlaying||s.key!==o.song.key?(u(),y("span",Le,c(r+1),1)):(u(),y("svg",Pe,[...i[4]||(i[4]=[e("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"},[e("animate",{attributeName:"height",values:"4;16;4",dur:"1.2s",repeatCount:"indefinite",begin:"0s"}),e("animate",{attributeName:"y",values:"10;4;10",dur:"1.2s",repeatCount:"indefinite",begin:"0s"})],-1),e("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"},[e("animate",{attributeName:"height",values:"16;4;16",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"}),e("animate",{attributeName:"y",values:"4;10;4",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"})],-1)])]))]),e("div",Me,[e("img",{src:`/assets/stories/${a.lang}/${s.key}.webp`,alt:s.name},null,8,Be)]),e("div",Ve,[I(a.VText,{variant:"body",color:"high"},{default:T(()=>[q(c(s.name),1)]),_:2},1024)])],10,Ie))),128))])])])]),_:1})}const Ue=W(oe,[["render",Ae]]);export{Ue as default};
