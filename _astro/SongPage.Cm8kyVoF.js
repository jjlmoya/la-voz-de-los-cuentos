import{_ as K,g as Q,w as W,I as X}from"./_plugin-vue_export-helper.Cgt_oGRB.js";import{B as Z}from"./Breadcrumbs.Dj4ff5JB.js";import{t as $}from"./index.CiAthMTf.js";import{a as ee,b as Y}from"./index.BMPHkLeA.js";/* empty css                      */import{a as te,w as b,g as f,j as E,k as w,h as j,l as U,o as g,b as T,e,t as r,c as _,d as x,F as z,r as D,m as h,f as O}from"./runtime-dom.esm-bundler.n5zixiYy.js";/* empty css                      */const ae={__name:"SongPage",props:{song:{type:Object,required:!0},allSongs:{type:Array,default:()=>[]},currentSaga:{type:Object,default:null},relatedStory:{type:Object,default:null}},setup(C,{expose:i}){i();const s="es",a=t=>{if(!t)return"";const n=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,v=t.match(n);return v&&v[2].length===11?v[2]:t},l=C,c=f(!1),o=f(!0),y=f(!1),p=f(0);let u=null,d=null;const q=E(()=>l.song.lyrics?l.song.lyrics.replace(/<br\s*\/?>/gi,`
`).replace(/\n{3,}/g,`

`).replace(/\n/g,"<br>"):""),I=t=>p.value>=t.start&&p.value<t.end;w(p,()=>{if(!l.song.syncedLyrics||l.song.syncedLyrics.length===0)return;const t=l.song.syncedLyrics.findIndex(n=>I(n));if(t!==-1){const n=document.querySelector(".song-page__karaoke-content"),v=document.querySelectorAll(".song-page__karaoke-line")[t];if(n&&v){const M=n.scrollTop,H=n.clientHeight,S=v.offsetTop-n.offsetTop,R=v.clientHeight,J=S-H/2+R/2;(S<M||S+R>M+H)&&n.scrollTo({top:J,behavior:"smooth"})}}});const m=()=>{d&&clearInterval(d),d=setInterval(()=>{u&&typeof u.getCurrentTime=="function"&&(p.value=u.getCurrentTime())},100)},F=()=>{c.value=!c.value,c.value&&(o.value=!1)},G=()=>{o.value=!o.value,o.value&&(c.value=!1)},L=()=>{c.value?u?.playVideo():o.value&&P()},P=()=>{const t=l.allSongs.findIndex(n=>n.key===l.song.key);if(t!==-1&&t<l.allSongs.length-1){const n=l.allSongs[t+1];A(n.key)}},A=t=>{window.location.href=Y(t)},B=()=>{if(window.YT)k();else{const t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";const n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),window.onYouTubeIframeAPIReady=k}},k=()=>{const t=a(l.song.song);u=new window.YT.Player(`youtube-player-${l.song.key}`,{videoId:t,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,modestbranding:1,cc_load_policy:1},events:{onReady:n=>{window.__ytPlayer=n.target,m()},onStateChange:n=>{n.data===window.YT.PlayerState.ENDED&&L(),n.data===window.YT.PlayerState.PLAYING&&(y.value=!0,m()),n.data===window.YT.PlayerState.PAUSED&&d&&clearInterval(d)}}})};j(()=>{y.value=!0;const t=localStorage.getItem("songRepeat"),n=localStorage.getItem("songAutoplay");t!==null&&(c.value=t==="true"),n!==null&&(o.value=n==="true"),B()});const V=()=>{localStorage.setItem("songRepeat",c.value),localStorage.setItem("songAutoplay",o.value)};w([c,o],V),U(()=>{d&&clearInterval(d)});const N={lang:s,extractYoutubeId:a,props:l,isRepeat:c,isAutoplay:o,isPlaying:y,currentTime:p,get player(){return u},set player(t){u=t},get timeUpdateInterval(){return d},set timeUpdateInterval(t){d=t},lyricsHTML:q,isLineActive:I,startTimeTracking:m,toggleRepeat:F,toggleAutoplay:G,handleSongEnded:L,playNextSong:P,navigateToSong:A,initYouTubePlayer:B,createPlayer:k,savePreferences:V,get VText(){return X},get VButton(){return W},get VContainer(){return Q},Breadcrumbs:Z,ref:f,computed:E,onMounted:j,onUnmounted:U,watch:w,get t(){return $},get toSong(){return Y},get toStory(){return ee}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},ne={class:"song-page__title"},se={class:"song-page__layout"},oe={class:"song-page__main"},le={class:"song-page__video-container"},re=["id"],ie={key:0,class:"song-page__karaoke"},ce={class:"song-page__karaoke-title"},ge={class:"song-page__karaoke-content"},de={class:"song-page__controls-section"},_e={key:1,class:"song-page__story-card"},ye=["href"],ue={class:"song-page__story-image"},ve=["src","alt"],pe={class:"song-page__story-info"},fe={class:"song-page__story-label"},he={class:"song-page__story-title"},me={key:2,class:"song-page__lyrics"},ke={class:"song-page__lyrics-title"},Se=["innerHTML"],be={class:"song-page__playlist"},we={class:"song-page__playlist-items"},Te=["onClick"],xe={class:"song-page__playlist-number"},Ce={key:0},Ie={key:1,viewBox:"0 0 24 24",fill:"currentColor"},Le={class:"song-page__playlist-cover"},Pe=["src","alt"],Ae={class:"song-page__playlist-info"};function Be(C,i,s,a,l,c){return g(),te(a.VContainer,{size:"xl",class:"song-page"},{default:b(()=>[T(a.Breadcrumbs,{"current-page":s.song.name,"saga-name":s.currentSaga?.name,"saga-key":s.currentSaga?.key},null,8,["current-page","saga-name","saga-key"]),e("h1",ne,r(s.song.name),1),e("div",se,[e("div",oe,[e("div",le,[e("div",{id:`youtube-player-${s.song.key}`,class:"song-page__video"},null,8,re)]),s.song.syncedLyrics&&s.song.syncedLyrics.length>0?(g(),_("div",ie,[e("h2",ce,r(a.t("page.song.lyrics")),1),e("div",ge,[(g(!0),_(z,null,D(s.song.syncedLyrics,(o,y)=>(g(),_("div",{key:y,class:h({"song-page__karaoke-line":!0,"song-page__karaoke-line--active":a.isLineActive(o)})},r(o.text),3))),128))])])):x("",!0),e("div",de,[e("button",{onClick:a.toggleRepeat,class:h([{active:a.isRepeat},"song-page__control"])},[i[0]||(i[0]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M17 1l4 4-4 4M3 11V9a4 4 0 0 1 4-4h14M7 23l-4-4 4-4M21 13v2a4 4 0 0 1-4 4H3"})],-1)),e("span",null,r(a.t("page.song.repeat")),1)],2),e("button",{onClick:a.toggleAutoplay,class:h([{active:a.isAutoplay},"song-page__control"])},[i[1]||(i[1]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M5 3l14 9-14 9V3z"}),e("path",{d:"M19 3v18"})],-1)),e("span",null,r(a.t("page.song.autoplay")),1)],2)]),s.relatedStory?(g(),_("div",_e,[e("a",{href:a.toStory(s.relatedStory.key),class:"song-page__story-link"},[e("div",ue,[e("img",{src:`/assets/stories/${a.lang}/${s.relatedStory.key}.webp`,alt:s.relatedStory.name},null,8,ve)]),e("div",pe,[e("span",fe,r(a.t("page.song.readStory")),1),e("h3",he,r(s.relatedStory.name),1)]),i[2]||(i[2]=e("svg",{class:"song-page__story-arrow",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"})],-1))],8,ye)])):x("",!0),s.song.lyrics&&(!s.song.syncedLyrics||s.song.syncedLyrics.length===0)?(g(),_("div",me,[e("h2",ke,r(a.t("page.song.lyrics")),1),e("div",{class:"song-page__lyrics-content",innerHTML:a.lyricsHTML},null,8,Se)])):x("",!0)]),e("div",be,[T(a.VText,{variant:"subtitle",color:"high",class:"song-page__playlist-title"},{default:b(()=>[O(r(a.t("page.song.playlist")),1)]),_:1}),e("div",we,[(g(!0),_(z,null,D(s.allSongs,(o,y)=>(g(),_("div",{key:o.key,class:h([{"song-page__playlist-item--active":o.key===s.song.key,"song-page__playlist-item--playing":a.isPlaying&&o.key===s.song.key},"song-page__playlist-item"]),onClick:p=>a.navigateToSong(o.key)},[e("div",xe,[!a.isPlaying||o.key!==s.song.key?(g(),_("span",Ce,r(y+1),1)):(g(),_("svg",Ie,[...i[3]||(i[3]=[e("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"},[e("animate",{attributeName:"height",values:"4;16;4",dur:"1.2s",repeatCount:"indefinite",begin:"0s"}),e("animate",{attributeName:"y",values:"10;4;10",dur:"1.2s",repeatCount:"indefinite",begin:"0s"})],-1),e("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"},[e("animate",{attributeName:"height",values:"16;4;16",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"}),e("animate",{attributeName:"y",values:"4;10;4",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"})],-1)])]))]),e("div",Le,[e("img",{src:`/assets/stories/${a.lang}/${o.key}.webp`,alt:o.name},null,8,Pe)]),e("div",Ae,[T(a.VText,{variant:"body",color:"high"},{default:b(()=>[O(r(o.name),1)]),_:2},1024)])],10,Te))),128))])])])]),_:1})}const je=K(ae,[["render",Be]]);export{je as default};
