import{_ as K,g as Q,w as W,I as X}from"./_plugin-vue_export-helper.7KydQm6F.js";import{B as Z}from"./Breadcrumbs.D50B5awX.js";import{t as $}from"./index.BBNXm_8Y.js";import{a as ee,b as R}from"./index.BMPHkLeA.js";/* empty css                      */import{a as te,w as b,g as f,j as E,k as w,i as j,l as U,o as g,b as T,e,t as c,c as _,d as x,F as z,r as D,m,f as O}from"./runtime-dom.esm-bundler.D_sgtVtG.js";/* empty css                      */const ae={__name:"SongPage",props:{song:{type:Object,required:!0},allSongs:{type:Array,default:()=>[]},currentSaga:{type:Object,default:null},relatedStory:{type:Object,default:null}},setup(C,{expose:r}){r();const s="es",n=t=>{if(!t)return"";const a=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,p=t.match(a);return p&&p[2].length===11?p[2]:t},l=C,i=f(!1),o=f(!0),u=f(!1),v=f(0);let y=null,d=null;const q=E(()=>l.song.lyrics?l.song.lyrics.replace(/<br\s*\/?>/gi,`
`).replace(/\n{3,}/g,`

`).replace(/\n/g,"<br>"):""),I=t=>v.value>=t.start&&v.value<t.end;w(v,()=>{if(!l.song.syncedLyrics||l.song.syncedLyrics.length===0)return;const t=l.song.syncedLyrics.findIndex(a=>I(a));if(t!==-1){const a=document.querySelector(".song-page__karaoke"),p=document.querySelectorAll(".song-page__karaoke-line")[t];if(a&&p){const M=a.scrollTop,Y=a.clientHeight,S=p.offsetTop-a.offsetTop,H=p.clientHeight,J=S-Y/2+H/2;(S<M||S+H>M+Y)&&a.scrollTo({top:J,behavior:"smooth"})}}});const h=()=>{d&&clearInterval(d),d=setInterval(()=>{y&&typeof y.getCurrentTime=="function"&&(v.value=y.getCurrentTime())},100)},F=()=>{i.value=!i.value,i.value&&(o.value=!1)},G=()=>{o.value=!o.value,o.value&&(i.value=!1)},P=()=>{i.value?y?.playVideo():o.value&&L()},L=()=>{const t=l.allSongs.findIndex(a=>a.key===l.song.key);if(t!==-1&&t<l.allSongs.length-1){const a=l.allSongs[t+1];A(a.key)}},A=t=>{window.location.href=R(t)},B=()=>{if(window.YT)k();else{const t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";const a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a),window.onYouTubeIframeAPIReady=k}},k=()=>{const t=n(l.song.song);y=new window.YT.Player(`youtube-player-${l.song.key}`,{videoId:t,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,modestbranding:1,cc_load_policy:1},events:{onReady:a=>{window.__ytPlayer=a.target,console.log("âœ… YouTube Player listo! Prueba: window.__ytPlayer.getCurrentTime()"),h()},onStateChange:a=>{a.data===window.YT.PlayerState.ENDED&&P(),a.data===window.YT.PlayerState.PLAYING&&(u.value=!0,h()),a.data===window.YT.PlayerState.PAUSED&&d&&clearInterval(d)}}})};j(()=>{u.value=!0;const t=localStorage.getItem("songRepeat"),a=localStorage.getItem("songAutoplay");t!==null&&(i.value=t==="true"),a!==null&&(o.value=a==="true"),B()});const V=()=>{localStorage.setItem("songRepeat",i.value),localStorage.setItem("songAutoplay",o.value)};w([i,o],V),U(()=>{d&&clearInterval(d)});const N={lang:s,extractYoutubeId:n,props:l,isRepeat:i,isAutoplay:o,isPlaying:u,currentTime:v,get player(){return y},set player(t){y=t},get timeUpdateInterval(){return d},set timeUpdateInterval(t){d=t},lyricsHTML:q,isLineActive:I,startTimeTracking:h,toggleRepeat:F,toggleAutoplay:G,handleSongEnded:P,playNextSong:L,navigateToSong:A,initYouTubePlayer:B,createPlayer:k,savePreferences:V,get VText(){return X},get VButton(){return W},get VContainer(){return Q},Breadcrumbs:Z,ref:f,computed:E,onMounted:j,onUnmounted:U,watch:w,get t(){return $},get toSong(){return R},get toStory(){return ee}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},ne={class:"song-page__title"},oe={class:"song-page__layout"},se={class:"song-page__main"},le={class:"song-page__video-container"},re=["id"],ie={key:0,class:"song-page__karaoke"},ge={class:"song-page__controls-section"},ce={key:1,class:"song-page__story-card"},de=["href"],_e={class:"song-page__story-image"},ue=["src","alt"],ye={class:"song-page__story-info"},pe={class:"song-page__story-label"},ve={class:"song-page__story-title"},fe={key:2,class:"song-page__lyrics"},me={class:"song-page__lyrics-title"},he=["innerHTML"],ke={class:"song-page__playlist"},Se={class:"song-page__playlist-items"},be=["onClick"],we={class:"song-page__playlist-number"},Te={key:0},xe={key:1,viewBox:"0 0 24 24",fill:"currentColor"},Ce={class:"song-page__playlist-cover"},Ie=["src","alt"],Pe={class:"song-page__playlist-info"};function Le(C,r,s,n,l,i){return g(),te(n.VContainer,{size:"xl",class:"song-page"},{default:b(()=>[T(n.Breadcrumbs,{"current-page":s.song.name,"saga-name":s.currentSaga?.name,"saga-key":s.currentSaga?.key},null,8,["current-page","saga-name","saga-key"]),e("h1",ne,c(s.song.name),1),e("div",oe,[e("div",se,[e("div",le,[e("div",{id:`youtube-player-${s.song.key}`,class:"song-page__video"},null,8,re)]),s.song.syncedLyrics&&s.song.syncedLyrics.length>0?(g(),_("div",ie,[(g(!0),_(z,null,D(s.song.syncedLyrics,(o,u)=>(g(),_("div",{key:u,class:m([{"song-page__karaoke-line":!0,"song-page__karaoke-line--active":n.isLineActive(o)},"song-page__karaoke-line"])},c(o.text),3))),128))])):x("",!0),e("div",ge,[e("button",{onClick:n.toggleRepeat,class:m([{active:n.isRepeat},"song-page__control"])},[r[0]||(r[0]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M17 1l4 4-4 4M3 11V9a4 4 0 0 1 4-4h14M7 23l-4-4 4-4M21 13v2a4 4 0 0 1-4 4H3"})],-1)),e("span",null,c(n.t("page.song.repeat")),1)],2),e("button",{onClick:n.toggleAutoplay,class:m([{active:n.isAutoplay},"song-page__control"])},[r[1]||(r[1]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M5 3l14 9-14 9V3z"}),e("path",{d:"M19 3v18"})],-1)),e("span",null,c(n.t("page.song.autoplay")),1)],2)]),s.relatedStory?(g(),_("div",ce,[e("a",{href:n.toStory(s.relatedStory.key),class:"song-page__story-link"},[e("div",_e,[e("img",{src:`/assets/stories/${n.lang}/${s.relatedStory.key}.webp`,alt:s.relatedStory.name},null,8,ue)]),e("div",ye,[e("span",pe,c(n.t("page.song.readStory")),1),e("h3",ve,c(s.relatedStory.name),1)]),r[2]||(r[2]=e("svg",{class:"song-page__story-arrow",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"})],-1))],8,de)])):x("",!0),s.song.lyrics?(g(),_("div",fe,[e("h2",me,c(n.t("page.song.lyrics")),1),e("div",{class:"song-page__lyrics-content",innerHTML:n.lyricsHTML},null,8,he)])):x("",!0)]),e("div",ke,[T(n.VText,{variant:"subtitle",color:"high",class:"song-page__playlist-title"},{default:b(()=>[O(c(n.t("page.song.playlist")),1)]),_:1}),e("div",Se,[(g(!0),_(z,null,D(s.allSongs,(o,u)=>(g(),_("div",{key:o.key,class:m([{"song-page__playlist-item--active":o.key===s.song.key,"song-page__playlist-item--playing":n.isPlaying&&o.key===s.song.key},"song-page__playlist-item"]),onClick:v=>n.navigateToSong(o.key)},[e("div",we,[!n.isPlaying||o.key!==s.song.key?(g(),_("span",Te,c(u+1),1)):(g(),_("svg",xe,[...r[3]||(r[3]=[e("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"},[e("animate",{attributeName:"height",values:"4;16;4",dur:"1.2s",repeatCount:"indefinite",begin:"0s"}),e("animate",{attributeName:"y",values:"10;4;10",dur:"1.2s",repeatCount:"indefinite",begin:"0s"})],-1),e("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"},[e("animate",{attributeName:"height",values:"16;4;16",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"}),e("animate",{attributeName:"y",values:"4;10;4",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"})],-1)])]))]),e("div",Ce,[e("img",{src:`/assets/stories/${n.lang}/${o.key}.webp`,alt:o.name},null,8,Ie)]),e("div",Pe,[T(n.VText,{variant:"body",color:"high"},{default:b(()=>[O(c(o.name),1)]),_:2},1024)])],10,be))),128))])])])]),_:1})}const Re=K(ae,[["render",Le]]);export{Re as default};
