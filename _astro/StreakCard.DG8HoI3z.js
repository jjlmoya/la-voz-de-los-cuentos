import{t as T}from"./index.Br1Li-Ke.js";/* empty css                       */import{_ as V}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{g,e as k,j as D,t as y,F as j,h as A,r as _,B as E,f as F,l as C,o as S,n as U,b as O}from"./runtime-core.esm-bundler.BLIdz6c-.js";const W={__name:"StreakCard",setup(R,{expose:p}){p();const m=_(0),t=_([]),h=_(!1),f=_(0),s=()=>{console.log("Storage change detected, recalculating streak..."),f.value++};E(f,()=>{w()}),F(()=>{w(),window.addEventListener("storage",s),window.addEventListener("storage:updated",s)}),C(()=>{window.removeEventListener("storage",s),window.removeEventListener("storage:updated",s)});const l=e=>{try{const r=JSON.parse(localStorage.getItem("storiesData"))||[],o=JSON.parse(localStorage.getItem("songsData"))||[],a=[...r,...o];let c=0;return a.forEach(n=>{if(n&&n.finished){const u=n.completedAt||Date.now(),d=new Date(u);d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")===e&&c++}}),c}catch(r){return console.error("Error getting completed count:",r),0}},w=()=>{const e=[],r=new Date;for(let o=6;o>=0;o--){const a=new Date(r);a.setDate(a.getDate()-o);const c=a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0"),n=a.toLocaleDateString("en-US",{weekday:"short"}),u=l(c);e.push({date:c,label:o===0?"Today":n,count:u,isToday:o===0})}t.value=e,h.value=e[6].count>0,L()},L=()=>{try{const e=JSON.parse(localStorage.getItem("storiesData"))||[],r=JSON.parse(localStorage.getItem("songsData"))||[],o=[...e,...r],a={};o.forEach(i=>{if(i&&i.finished){const J=i.completedAt||Date.now(),v=new Date(J),M=v.getFullYear()+"-"+String(v.getMonth()+1).padStart(2,"0")+"-"+String(v.getDate()).padStart(2,"0");a[M]||(a[M]=0),a[M]++}});let c=0;const n=new Date,u=n.getFullYear()+"-"+String(n.getMonth()+1).padStart(2,"0")+"-"+String(n.getDate()).padStart(2,"0");let d=new Date(n);for(d.setDate(d.getDate()-1);;){const i=d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0");if(a[i]&&a[i]>0)c++,d.setDate(d.getDate()-1);else break}a[u]&&a[u]>0&&(c+=1),m.value=c}catch(e){console.error("Error updating current streak:",e),m.value=0}},b=["/assets/streak/stickers/s1.webp","/assets/streak/stickers/s2.webp","/assets/streak/stickers/s3.webp","/assets/streak/stickers/s4.webp","/assets/streak/stickers/s5.webp","/assets/streak/stickers/s6.webp","/assets/streak/stickers/s7.webp","/assets/streak/stickers/s8.webp"];function z(e){const r=t.value[e];if(!r)return b[0];const[o,a,c]=r.date.split("-").map(Number),n=(o*1e4+a*100+c)%8;return b[n]}function B(e){const r=Math.sin(e*12.9898+78.233)*43758.5453;return(r-Math.floor(r))*45-22.5}function I(e){const r=Math.sin(e*34.233+45.164)*34748.2384;return(r-Math.floor(r))*20-10}function Y(e){if(e.isToday)return T("streak.today");const o={Mon:"streak.mon",Tue:"streak.tue",Wed:"streak.wed",Thu:"streak.thu",Fri:"streak.fri",Sat:"streak.sat",Sun:"streak.sun"}[e.label];return o?T(o):e.label}const N={currentStreak:m,last7Days:t,hasStreakToday:h,updateTrigger:f,handleStorageChange:s,getCompletedCountForDate:l,calculateLast7Days:w,updateCurrentStreak:L,starStickers:b,getSticker:z,getRandomRotation:B,getRandomOffset:I,getLocalizedDayLabel:Y,onMounted:F,onUnmounted:C,ref:_,watch:E,get t(){return T}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},K={class:"streak-card__header"},P={class:"streak-card__label"},q={class:"streak-card__days"},G=["src","alt"],H={key:1,class:"streak-card__day-number"},Q={class:"streak-card__day-label"};function X(R,p,m,t,h,f){return S(),g("div",{class:D(["streak-card",{"streak-card--milestone-25":t.currentStreak%25===0&&t.currentStreak>0,"streak-card--milestone-50":t.currentStreak%50===0&&t.currentStreak>0}])},[p[0]||(p[0]=k("div",{class:"streak-card__top-spacing"},null,-1)),k("div",K,[k("div",{class:D(["streak-card__number",{"streak-card__number--pulse-intense":t.currentStreak%25===0&&t.currentStreak>0,"streak-card__number--frozen":!t.hasStreakToday&&t.currentStreak>0,"streak-card__number--burning":t.hasStreakToday}])},y(t.currentStreak),3),k("div",P,y(t.t("streak.label")),1)]),k("div",q,[(S(!0),g(j,null,A(t.last7Days,(s,l)=>(S(),g("div",{key:l,class:D(["streak-card__day-wrapper",{"streak-card__day-wrapper--second-row":l>=4}]),style:U({"--delay":`${l*.15}s`,"--rotation":`${t.getRandomRotation(l)}deg`,"--offset":`${t.getRandomOffset(l)}px`})},[k("div",{class:D(["streak-card__day-dot",{"streak-card__day-dot--empty":s.count===0,"streak-card__day-dot--one":s.count===1,"streak-card__day-dot--epic":s.count>1,"streak-card__day-dot--today":s.isToday}])},[s.count>0?(S(),g("img",{key:0,src:t.getSticker(l),alt:`sticker-${l}`,class:"streak-card__sticker streak-card__day-img--drop"},null,8,G)):O("",!0),s.count>1?(S(),g("span",H,y(s.count),1)):O("",!0)],2),k("div",Q,y(t.getLocalizedDayLabel(s)),1)],6))),128))])],2)}const et=V(W,[["render",X],["__scopeId","data-v-d64cc5c8"]]);export{et as default};
