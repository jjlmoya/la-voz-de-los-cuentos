import{t as C}from"./index.Br1Li-Ke.js";/* empty css                       */import{_ as W}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{g as u,e as l,j as f,t as w,F as j,h as A,r as _,B as E,f as I,l as x,o as p,n as U,b as N}from"./runtime-core.esm-bundler.BLIdz6c-.js";const K={__name:"StreakCard",setup(O,{expose:S}){S();const d=_(0),t=_([]),y=_(!1),h=_(0),r=()=>{console.log("Storage change detected, recalculating streak..."),h.value++};E(h,()=>{b()}),I(()=>{b(),window.addEventListener("storage",r),window.addEventListener("storage:updated",r)}),x(()=>{window.removeEventListener("storage",r),window.removeEventListener("storage:updated",r)});const o=e=>{try{const a=JSON.parse(localStorage.getItem("storiesData"))||[],n=JSON.parse(localStorage.getItem("songsData"))||[],s=[...a,...n];let m=0;return s.forEach(g=>{if(g&&g.finished){const i=g.completedAt||Date.now(),c=new Date(i);c.getFullYear()+"-"+String(c.getMonth()+1).padStart(2,"0")+"-"+String(c.getDate()).padStart(2,"0")===e&&m++}}),m}catch(a){return console.error("Error getting completed count:",a),0}},b=()=>{const e=[],a=new Date;for(let n=6;n>=0;n--){const s=new Date(a);s.setDate(s.getDate()-n);const m=s.getFullYear()+"-"+String(s.getMonth()+1).padStart(2,"0")+"-"+String(s.getDate()).padStart(2,"0"),g=s.toLocaleDateString("en-US",{weekday:"short"}),i=o(m);e.push({date:m,label:n===0?"Today":g,count:i,isToday:n===0})}t.value=e,y.value=e[6].count>0,T()},T=()=>{try{const e=JSON.parse(localStorage.getItem("storiesData"))||[],a=JSON.parse(localStorage.getItem("songsData"))||[],n=[...e,...a],s={};n.forEach(c=>{if(c&&c.finished){const L=c.completedAt||Date.now(),D=new Date(L),v=D.getFullYear()+"-"+String(D.getMonth()+1).padStart(2,"0")+"-"+String(D.getDate()).padStart(2,"0");s[v]||(s[v]=0),s[v]++}});let m=0;const g=new Date;let i=new Date(g);for(;;){const c=i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0");if(s[c]&&s[c]>0)m++,i.setDate(i.getDate()-1);else break}d.value=m}catch(e){console.error("Error updating current streak:",e),d.value=0}},M=["/assets/streak/stickers/s1.webp","/assets/streak/stickers/s2.webp","/assets/streak/stickers/s3.webp","/assets/streak/stickers/s4.webp","/assets/streak/stickers/s5.webp","/assets/streak/stickers/s6.webp","/assets/streak/stickers/s7.webp","/assets/streak/stickers/s8.webp"],k=[{min:0,max:0,image:"/assets/streak/characters/tiny-flame.webp",name:"Tiny Flame"},{min:1,max:1,image:"/assets/streak/characters/tiny-flame.webp",name:"Tiny Flame"},{min:2,max:4,image:"/assets/streak/characters/ember-starter.webp",name:"Ember Starter"},{min:5,max:9,image:"/assets/streak/characters/spark-igniter.webp",name:"Spark Igniter"},{min:10,max:19,image:"/assets/streak/characters/flame-warrior.webp",name:"Flame Warrior"},{min:20,max:39,image:"/assets/streak/characters/blazing-master.webp",name:"Blazing Master"},{min:40,max:59,image:"/assets/streak/characters/inferno-champion.webp",name:"Inferno Champion"},{min:60,max:79,image:"/assets/streak/characters/eternal-flame.webp",name:"Eternal Flame"},{min:80,max:1/0,image:"/assets/streak/characters/cosmic-inferno.webp",name:"Cosmic Inferno"}];function z(e){return M[e%8]}function B(){const e=k.find(a=>d.value>=a.min&&d.value<=a.max);return e?e.image:k[0].image}function R(){const e=k.find(a=>d.value>=a.min&&d.value<=a.max);return e?e.name:k[0].name}function J(e){const a=Math.sin(e*12.9898+78.233)*43758.5453;return(a-Math.floor(a))*45-22.5}function V(e){const a=Math.sin(e*34.233+45.164)*34748.2384;return(a-Math.floor(a))*20-10}function Y(e){if(e.isToday)return C("streak.today");const n={Mon:"streak.mon",Tue:"streak.tue",Wed:"streak.wed",Thu:"streak.thu",Fri:"streak.fri",Sat:"streak.sat",Sun:"streak.sun"}[e.label];return n?C(n):e.label}const F={currentStreak:d,last7Days:t,hasStreakToday:y,updateTrigger:h,handleStorageChange:r,getCompletedCountForDate:o,calculateLast7Days:b,updateCurrentStreak:T,starStickers:M,characterLevels:k,getSticker:z,getCharacterImage:B,getCharacterName:R,getRandomRotation:J,getRandomOffset:V,getLocalizedDayLabel:Y,onMounted:I,onUnmounted:x,ref:_,watch:E,get t(){return C}};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}},P={class:"streak-card__header"},q={class:"streak-card__character"},G=["src","alt"],H={class:"streak-card__label"},Q={class:"streak-card__days"},X=["src","alt"],Z={key:0,class:"streak-card__day-number"},$={class:"streak-card__day-label"};function ee(O,S,d,t,y,h){return p(),u("div",{class:f(["streak-card",{"streak-card--milestone-25":t.currentStreak%25===0&&t.currentStreak>0,"streak-card--milestone-50":t.currentStreak%50===0&&t.currentStreak>0}])},[S[0]||(S[0]=l("div",{class:"streak-card__top-spacing"},null,-1)),l("div",P,[l("div",q,[l("img",{src:t.getCharacterImage(),alt:t.getCharacterName(),class:"streak-card__character-img"},null,8,G)]),l("div",{class:f(["streak-card__number",{"streak-card__number--pulse-intense":t.currentStreak%25===0&&t.currentStreak>0,"streak-card__number--frozen":!t.hasStreakToday&&t.currentStreak>0,"streak-card__number--burning":t.hasStreakToday}])},w(t.currentStreak),3),l("div",H,w(t.t("streak.label")),1)]),l("div",Q,[(p(!0),u(j,null,A(t.last7Days,(r,o)=>(p(),u("div",{key:o,class:f(["streak-card__day-wrapper",{"streak-card__day-wrapper--second-row":o>=4}]),style:U({"--delay":`${o*.15}s`,"--rotation":`${t.getRandomRotation(o)}deg`,"--offset":`${t.getRandomOffset(o)}px`})},[r.count>0?(p(),u("img",{key:0,src:t.getSticker(o),alt:`sticker-${o}`,class:"streak-card__sticker streak-card__day-img--drop"},null,8,X)):N("",!0),l("div",{class:f(["streak-card__day-dot",{"streak-card__day-dot--empty":r.count===0,"streak-card__day-dot--one":r.count===1,"streak-card__day-dot--epic":r.count>1,"streak-card__day-dot--today":r.isToday}])},[r.count>1?(p(),u("span",Z,w(r.count),1)):N("",!0)],2),l("div",$,w(t.getLocalizedDayLabel(r)),1)],6))),128))])],2)}const ne=W(K,[["render",ee],["__scopeId","data-v-de808919"]]);export{ne as default};
