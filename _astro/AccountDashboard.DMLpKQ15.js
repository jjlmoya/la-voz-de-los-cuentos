import I from"./AccountSummary.CTPLyct_.js";import{u as T}from"./useStories.D0wU7qQi.js";import{a as M}from"./index.CqFlbLC_.js";import{a as V}from"./index.Dj5k6ggm.js";import{t as j}from"./index.C5Cnp1uk.js";import{_ as C}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{g as n,e as t,b,t as a,a as E,F as N,h as x,r as u,f as A,j as O,o as i,n as z}from"./runtime-core.esm-bundler.OheDorFq.js";import"./index-FitP4J_6.QqNa7N4F.js";import"./runtime-dom.esm-bundler.0lIbTe_P.js";import"./useAchievements.DYniAc26.js";import"./achievementEvents.DHKWVqNG.js";import"./useStory.UFTN_M2T.js";import"./landings.D6rrVUZj.js";const J={__name:"AccountDashboard",props:{lang:{type:String,default:"es"}},setup(D,{expose:r}){r();const{getAllStories:m}=T(),s=M(),p=l=>{const d=s.find(_=>_.key===l);return d?d.name:l},g=u(0),e=u(0),S=u(0),f=u([]),v=u([]);A(()=>{if(!(typeof localStorage>"u"))try{const l=localStorage.getItem("storiesData");if(!l)return;const d=JSON.parse(l);if(!Array.isArray(d))return;const _=m(),w=d.reduce((o,c)=>o+(c.spentTime||0),0);g.value=Math.round(w/3600);const k=d.filter(o=>o.finished===!0).length;e.value=_.length>0?Math.round(k/_.length*100):0,S.value=k;const R=d.map(o=>{const c=_.find(F=>F.key===o.key);if(!c)return null;const h=parseFloat(String(o.totalTime).replace(",","."));if(isNaN(h)||h<=0)return null;const B=Math.round(o.spentTime/h*100);return{...c,timeSpent:Math.max(0,Math.round(o.spentTime/60)),totalTime:Math.max(1,Math.ceil(h/60)),progress:Math.min(100,Math.max(0,B))}}).filter(o=>o&&o.progress>0&&o.progress<100).sort((o,c)=>c.timeSpent-o.timeSpent).slice(0,3);f.value=R;const P=_.filter(o=>{const c=d.find(h=>h.key===o.key);return!c||c.finished!==!0});v.value=P.sort(()=>Math.random()-.5).slice(0,3)}catch(l){console.error("Error loading dashboard data:",l)}});const y={getAllStories:m,allSagas:s,getSagaName:p,totalTimeSpent:g,progressPercentage:e,storiesRead:S,recentStories:f,suggestedStories:v,ref:u,onMounted:A,computed:O,AccountSummary:I,get useStories(){return T},get getSagas(){return M},get toStory(){return V},get t(){return j}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}},L={class:"account-dashboard"},W={class:"dashboard-header"},q={class:"dashboard-header__content"},G={class:"dashboard-header__title"},H={class:"dashboard-header__subtitle"},Q={class:"dashboard-summary"},U={class:"dashboard-section"},X={class:"dashboard-section__title"},Y={class:"stats-grid"},Z={class:"stat-card stat-card--time"},K={class:"stat-card__label"},$={class:"stat-card__value"},tt={class:"stat-card stat-card--progress"},st={class:"stat-card__label"},at={class:"stat-card__value"},et={class:"stat-card stat-card--books"},ot={class:"stat-card__label"},rt={class:"stat-card__value"},ct={key:0,class:"dashboard-section"},dt={class:"dashboard-section__title"},nt={class:"stories-row"},it=["href"],lt={class:"story-card__progress"},_t={class:"story-card__content"},ht={class:"story-card__title"},ut={class:"story-card__time"},mt={key:1,class:"dashboard-section"},gt={class:"dashboard-section__title"},bt={class:"stories-carousel"},pt=["href"],St={class:"carousel-card__header"},ft={class:"carousel-card__tag"},vt={class:"carousel-card__content"},yt={class:"carousel-card__title"},kt={class:"carousel-card__time"},Tt={key:0,class:"carousel-card__saga"},Mt={class:"carousel-card__cta"};function Nt(D,r,m,s,p,g){return i(),n("div",L,[t("div",W,[t("div",q,[t("h1",G,a(s.t("account.dashboard.title")),1),t("p",H,a(s.t("account.dashboard.subtitle")),1)]),r[0]||(r[0]=t("div",{class:"dashboard-header__decoration"},[t("img",{src:"/assets/account/dashboard-assets/dashboard-decoration.webp",alt:"decoration",class:"dashboard-header__image"})],-1))]),t("div",Q,[E(s.AccountSummary,{lang:m.lang},null,8,["lang"])]),t("div",U,[t("h2",X,a(s.t("account.dashboard.statistics")),1),t("div",Y,[t("div",Z,[r[1]||(r[1]=t("img",{src:"/assets/account/dashboard-assets/stat-time.webp",alt:"time",class:"stat-card__icon"},null,-1)),t("div",K,a(s.t("account.dashboard.totalTime")),1),t("div",$,a(s.totalTimeSpent||0)+"h",1)]),t("div",tt,[r[2]||(r[2]=t("img",{src:"/assets/account/dashboard-assets/stat-progress.webp",alt:"progress",class:"stat-card__icon"},null,-1)),t("div",st,a(s.t("account.dashboard.progress")),1),t("div",at,a(s.progressPercentage||0)+"%",1)]),t("div",et,[r[3]||(r[3]=t("img",{src:"/assets/account/dashboard-assets/stat-books.webp",alt:"books",class:"stat-card__icon"},null,-1)),t("div",ot,a(s.t("account.dashboard.storiesRead")),1),t("div",rt,a(s.storiesRead||0),1)])])]),s.recentStories.length>0?(i(),n("div",ct,[t("h2",dt,a(s.t("account.dashboard.recentlyReading")),1),t("div",nt,[(i(!0),n(N,null,x(s.recentStories,e=>(i(),n("a",{key:e.key,href:s.toStory(e.key),class:"story-card"},[t("div",lt,[t("div",{class:"story-card__progress-bar",style:z({width:e.progress+"%"})},null,4)]),t("div",_t,[t("h3",ht,a(e.name),1),t("p",ut,a(e.timeSpent>0?e.timeSpent:0)+" min de "+a(e.totalTime>0?e.totalTime:0)+" min",1)])],8,it))),128))])])):b("",!0),s.suggestedStories.length>0?(i(),n("div",mt,[t("h2",gt,a(s.t("account.dashboard.nextToRead")),1),t("div",bt,[(i(!0),n(N,null,x(s.suggestedStories,e=>(i(),n("a",{key:e.key,href:s.toStory(e.key),class:"carousel-card"},[t("div",St,[t("span",ft,a(s.t("account.dashboard.suggested")),1)]),t("div",vt,[t("h3",yt,a(e.name),1),t("p",kt,a(e.time?Math.ceil(parseInt(e.time)/60):0)+" "+a(s.t("account.dashboard.minutes")),1),e.saga?(i(),n("p",Tt,a(s.getSagaName(e.saga)),1)):b("",!0)]),t("div",Mt,a(s.t("account.dashboard.start")),1)],8,pt))),128))])])):b("",!0)])}const Ot=C(J,[["render",Nt],["__scopeId","data-v-892fc54b"]]);export{Ot as default};
