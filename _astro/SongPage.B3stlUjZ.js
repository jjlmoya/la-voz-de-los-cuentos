import{_ as L,g as Y,w as j,I as H}from"./_plugin-vue_export-helper.BWZ8jbAJ.js";import{B as z}from"./Breadcrumbs.BcleR59w.js";import{t as O}from"./index.BBNXm_8Y.js";import{a as D,b as B}from"./index.B2XIrulY.js";/* empty css                      */import{c as F,w as m,r as y,j as V,h as M,k as N,o as c,a as h,e,t as g,f as _,b as P,l as f,d as I,F as q,g as G}from"./runtime-dom.esm-bundler.wpnN_IyH.js";/* empty css                      */const J={__name:"SongPage",props:{song:{type:Object,required:!0},allSongs:{type:Array,default:()=>[]},currentSaga:{type:Object,default:null},relatedStory:{type:Object,default:null}},setup(S,{expose:l}){l();const o="es",t=a=>{if(!a)return"";const n=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,v=a.match(n);return v&&v[2].length===11?v[2]:a},r=S,i=y(!1),s=y(!0),u=y(!1);let d=null;const A=V(()=>r.song.lyrics?r.song.lyrics.replace(/\n/g,"<br>"):""),R=()=>{i.value=!i.value,i.value&&(s.value=!1)},E=()=>{s.value=!s.value,s.value&&(i.value=!1)},b=()=>{i.value?d?.playVideo():s.value&&k()},k=()=>{const a=r.allSongs.findIndex(n=>n.key===r.song.key);if(a!==-1&&a<r.allSongs.length-1){const n=r.allSongs[a+1];w(n.key)}},w=a=>{window.location.href=B(a)},x=()=>{if(window.YT)p();else{const a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";const n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n),window.onYouTubeIframeAPIReady=p}},p=()=>{const a=t(r.song.song);d=new window.YT.Player(`youtube-player-${r.song.key}`,{videoId:a,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,modestbranding:1,cc_load_policy:1},events:{onStateChange:n=>{n.data===window.YT.PlayerState.ENDED&&b()}}})};M(()=>{u.value=!0;const a=localStorage.getItem("songRepeat"),n=localStorage.getItem("songAutoplay");a!==null&&(i.value=a==="true"),n!==null&&(s.value=n==="true"),x()});const C=()=>{localStorage.setItem("songRepeat",i.value),localStorage.setItem("songAutoplay",s.value)};N([i,s],C);const T={lang:o,extractYoutubeId:t,props:r,isRepeat:i,isAutoplay:s,isPlaying:u,get player(){return d},set player(a){d=a},lyricsHTML:A,toggleRepeat:R,toggleAutoplay:E,handleSongEnded:b,playNextSong:k,navigateToSong:w,initYouTubePlayer:x,createPlayer:p,savePreferences:C,get VText(){return H},get VButton(){return j},get VContainer(){return Y},Breadcrumbs:z,ref:y,computed:V,onMounted:M,watch:N,get t(){return O},get toSong(){return B},get toStory(){return D}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}},K={class:"song-page__title"},Q={class:"song-page__layout"},U={class:"song-page__main"},W={class:"song-page__video-container"},X=["id"],Z={class:"song-page__controls-section"},$={key:0,class:"song-page__story-card"},ee=["href"],te={class:"song-page__story-image"},ae=["src","alt"],se={class:"song-page__story-info"},oe={class:"song-page__story-label"},ne={class:"song-page__story-title"},le={key:1,class:"song-page__lyrics"},re={class:"song-page__lyrics-title"},ie=["innerHTML"],ge={class:"song-page__playlist"},ce={class:"song-page__playlist-items"},_e=["onClick"],de={class:"song-page__playlist-number"},ue={key:0},ye={key:1,viewBox:"0 0 24 24",fill:"currentColor"},pe={class:"song-page__playlist-cover"},ve=["src","alt"],me={class:"song-page__playlist-info"};function he(S,l,o,t,r,i){return c(),F(t.VContainer,{size:"xl",class:"song-page"},{default:m(()=>[h(t.Breadcrumbs,{"current-page":o.song.name,"saga-name":o.currentSaga?.name,"saga-key":o.currentSaga?.key},null,8,["current-page","saga-name","saga-key"]),e("h1",K,g(o.song.name),1),e("div",Q,[e("div",U,[e("div",W,[e("div",{id:`youtube-player-${o.song.key}`,class:"song-page__video"},null,8,X)]),e("div",Z,[e("button",{onClick:t.toggleRepeat,class:f([{active:t.isRepeat},"song-page__control"])},[l[0]||(l[0]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M17 1l4 4-4 4M3 11V9a4 4 0 0 1 4-4h14M7 23l-4-4 4-4M21 13v2a4 4 0 0 1-4 4H3"})],-1)),e("span",null,g(t.t("page.song.repeat")),1)],2),e("button",{onClick:t.toggleAutoplay,class:f([{active:t.isAutoplay},"song-page__control"])},[l[1]||(l[1]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M5 3l14 9-14 9V3z"}),e("path",{d:"M19 3v18"})],-1)),e("span",null,g(t.t("page.song.autoplay")),1)],2)]),o.relatedStory?(c(),_("div",$,[e("a",{href:t.toStory(o.relatedStory.key),class:"song-page__story-link"},[e("div",te,[e("img",{src:`/assets/stories/${t.lang}/${o.relatedStory.key}.webp`,alt:o.relatedStory.name},null,8,ae)]),e("div",se,[e("span",oe,g(t.t("page.song.readStory")),1),e("h3",ne,g(o.relatedStory.name),1)]),l[2]||(l[2]=e("svg",{class:"song-page__story-arrow",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"})],-1))],8,ee)])):P("",!0),o.song.lyrics?(c(),_("div",le,[e("h2",re,g(t.t("page.song.lyrics")),1),e("div",{class:"song-page__lyrics-content",innerHTML:t.lyricsHTML},null,8,ie)])):P("",!0)]),e("div",ge,[h(t.VText,{variant:"subtitle",color:"high",class:"song-page__playlist-title"},{default:m(()=>[I(g(t.t("page.song.playlist")),1)]),_:1}),e("div",ce,[(c(!0),_(q,null,G(o.allSongs,(s,u)=>(c(),_("div",{key:s.key,class:f([{"song-page__playlist-item--active":s.key===o.song.key,"song-page__playlist-item--playing":t.isPlaying&&s.key===o.song.key},"song-page__playlist-item"]),onClick:d=>t.navigateToSong(s.key)},[e("div",de,[!t.isPlaying||s.key!==o.song.key?(c(),_("span",ue,g(u+1),1)):(c(),_("svg",ye,[...l[3]||(l[3]=[e("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"},[e("animate",{attributeName:"height",values:"4;16;4",dur:"1.2s",repeatCount:"indefinite",begin:"0s"}),e("animate",{attributeName:"y",values:"10;4;10",dur:"1.2s",repeatCount:"indefinite",begin:"0s"})],-1),e("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"},[e("animate",{attributeName:"height",values:"16;4;16",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"}),e("animate",{attributeName:"y",values:"4;10;4",dur:"1.2s",repeatCount:"indefinite",begin:"0.3s"})],-1)])]))]),e("div",pe,[e("img",{src:`/assets/stories/${t.lang}/${s.key}.webp`,alt:s.name},null,8,ve)]),e("div",me,[h(t.VText,{variant:"body",color:"high"},{default:m(()=>[I(g(s.name),1)]),_:2},1024)])],10,_e))),128))])])])]),_:1})}const Te=L(J,[["render",he]]);export{Te as default};
